<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>7-进入三维世界 | 七色枫叶的学习基地</title>
    <meta name="description" content="不积跬步无以至千里，不积小流无以成江河">
    
    
    <link rel="preload" href="/fengyestudybase/assets/css/0.styles.5e309cc9.css" as="style"><link rel="preload" href="/fengyestudybase/assets/js/app.0a47e211.js" as="script"><link rel="preload" href="/fengyestudybase/assets/js/20.a5bcc6c6.js" as="script"><link rel="prefetch" href="/fengyestudybase/assets/js/10.30c47e52.js"><link rel="prefetch" href="/fengyestudybase/assets/js/11.4acf0b7f.js"><link rel="prefetch" href="/fengyestudybase/assets/js/12.01897755.js"><link rel="prefetch" href="/fengyestudybase/assets/js/13.927942cf.js"><link rel="prefetch" href="/fengyestudybase/assets/js/14.95996584.js"><link rel="prefetch" href="/fengyestudybase/assets/js/15.2a6554aa.js"><link rel="prefetch" href="/fengyestudybase/assets/js/16.2eacfb27.js"><link rel="prefetch" href="/fengyestudybase/assets/js/17.0faefb8a.js"><link rel="prefetch" href="/fengyestudybase/assets/js/18.dec666b8.js"><link rel="prefetch" href="/fengyestudybase/assets/js/19.61499d52.js"><link rel="prefetch" href="/fengyestudybase/assets/js/2.864db199.js"><link rel="prefetch" href="/fengyestudybase/assets/js/21.48500825.js"><link rel="prefetch" href="/fengyestudybase/assets/js/22.09012641.js"><link rel="prefetch" href="/fengyestudybase/assets/js/23.c64fdaef.js"><link rel="prefetch" href="/fengyestudybase/assets/js/24.fb975750.js"><link rel="prefetch" href="/fengyestudybase/assets/js/25.84edc7a1.js"><link rel="prefetch" href="/fengyestudybase/assets/js/26.48396beb.js"><link rel="prefetch" href="/fengyestudybase/assets/js/27.496aa837.js"><link rel="prefetch" href="/fengyestudybase/assets/js/28.3cd6297d.js"><link rel="prefetch" href="/fengyestudybase/assets/js/29.98c70977.js"><link rel="prefetch" href="/fengyestudybase/assets/js/3.ae847aa1.js"><link rel="prefetch" href="/fengyestudybase/assets/js/30.92c849a4.js"><link rel="prefetch" href="/fengyestudybase/assets/js/31.6bc95938.js"><link rel="prefetch" href="/fengyestudybase/assets/js/32.d7c431d6.js"><link rel="prefetch" href="/fengyestudybase/assets/js/33.aa073227.js"><link rel="prefetch" href="/fengyestudybase/assets/js/34.fe2e3207.js"><link rel="prefetch" href="/fengyestudybase/assets/js/35.b8405c57.js"><link rel="prefetch" href="/fengyestudybase/assets/js/36.c29f2ab2.js"><link rel="prefetch" href="/fengyestudybase/assets/js/37.9daf48c3.js"><link rel="prefetch" href="/fengyestudybase/assets/js/38.882175dc.js"><link rel="prefetch" href="/fengyestudybase/assets/js/39.bc5c4f62.js"><link rel="prefetch" href="/fengyestudybase/assets/js/4.5053f111.js"><link rel="prefetch" href="/fengyestudybase/assets/js/40.c93261a7.js"><link rel="prefetch" href="/fengyestudybase/assets/js/41.c99bbfa0.js"><link rel="prefetch" href="/fengyestudybase/assets/js/42.748aa826.js"><link rel="prefetch" href="/fengyestudybase/assets/js/43.67d3a0a7.js"><link rel="prefetch" href="/fengyestudybase/assets/js/5.9688edc8.js"><link rel="prefetch" href="/fengyestudybase/assets/js/6.b4df5c4c.js"><link rel="prefetch" href="/fengyestudybase/assets/js/7.c58bccaa.js"><link rel="prefetch" href="/fengyestudybase/assets/js/8.fb18315f.js"><link rel="prefetch" href="/fengyestudybase/assets/js/9.3c445c9c.js">
    <link rel="stylesheet" href="/fengyestudybase/assets/css/0.styles.5e309cc9.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/fengyestudybase/" class="home-link router-link-active"><!----> <span class="site-name">七色枫叶的学习基地</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/fengyestudybase/" class="nav-link">主页</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">我的学习</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/fengyestudybase/guide/" class="nav-link">前端开发综合知识</a></li><li class="dropdown-item"><!----> <a href="/fengyestudybase/JSbase/" class="nav-link">JS相关</a></li><li class="dropdown-item"><!----> <a href="/fengyestudybase/Webgl/" class="nav-link router-link-active">Webgl相关</a></li><li class="dropdown-item"><!----> <a href="/fengyestudybase/games/" class="nav-link">游戏相关</a></li><li class="dropdown-item"><!----> <a href="/fengyestudybase/readbook/" class="nav-link">读书专题---前端工程化体系设计与实践</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">我的项目</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://chen735623058.github.io/manifestEdit/dist/index.html#/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  manifest编辑器
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div><div class="nav-item"><a href="https://github.com/chen735623058" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/fengyestudybase/" class="nav-link">主页</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">我的学习</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/fengyestudybase/guide/" class="nav-link">前端开发综合知识</a></li><li class="dropdown-item"><!----> <a href="/fengyestudybase/JSbase/" class="nav-link">JS相关</a></li><li class="dropdown-item"><!----> <a href="/fengyestudybase/Webgl/" class="nav-link router-link-active">Webgl相关</a></li><li class="dropdown-item"><!----> <a href="/fengyestudybase/games/" class="nav-link">游戏相关</a></li><li class="dropdown-item"><!----> <a href="/fengyestudybase/readbook/" class="nav-link">读书专题---前端工程化体系设计与实践</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">我的项目</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://chen735623058.github.io/manifestEdit/dist/index.html#/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  manifest编辑器
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div><div class="nav-item"><a href="https://github.com/chen735623058" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/fengyestudybase/Webgl/" class="sidebar-link">主要包括一些Webgl相关的知识</a></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading open"><span>webgl学习</span> <span class="arrow down"></span></p> <ul class="sidebar-group-items"><li><a href="/fengyestudybase/Webgl/2-webgl-入门.html" class="sidebar-link">2-webgl 入门</a></li><li><a href="/fengyestudybase/Webgl/3-webgl-绘制和变换三角形.html" class="sidebar-link">3-绘制和变换三角形</a></li><li><a href="/fengyestudybase/Webgl/4-高级变换与动画基础.html" class="sidebar-link">4-高级变换和动画基础</a></li><li><a href="/fengyestudybase/Webgl/5-颜色与纹理.html" class="sidebar-link">5-颜色与纹理</a></li><li><a href="/fengyestudybase/Webgl/6-OpenGL ES着色器语言.html" class="sidebar-link">6-OpenGL ES着色器语言</a></li><li><a href="/fengyestudybase/Webgl/7-进入三维世界.html" class="active sidebar-link">7-进入三维世界</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/fengyestudybase/Webgl/7-进入三维世界.html#一、学习要点" class="sidebar-link">一、学习要点</a></li><li class="sidebar-sub-header"><a href="/fengyestudybase/Webgl/7-进入三维世界.html#二、立方体由三角形构成" class="sidebar-link">二、立方体由三角形构成</a></li><li class="sidebar-sub-header"><a href="/fengyestudybase/Webgl/7-进入三维世界.html#三、视点与视线" class="sidebar-link">三、视点与视线</a></li><li class="sidebar-sub-header"><a href="/fengyestudybase/Webgl/7-进入三维世界.html#四-从指定视点观察旋转后的三角形" class="sidebar-link">四 从指定视点观察旋转后的三角形</a></li><li class="sidebar-sub-header"><a href="/fengyestudybase/Webgl/7-进入三维世界.html#五、利用键盘改变视点" class="sidebar-link">五、利用键盘改变视点</a></li><li class="sidebar-sub-header"><a href="/fengyestudybase/Webgl/7-进入三维世界.html#六、可视范围（正射类型）" class="sidebar-link">六、可视范围（正射类型）</a></li><li class="sidebar-sub-header"><a href="/fengyestudybase/Webgl/7-进入三维世界.html#七、可视空间（透视投影）" class="sidebar-link">七、可视空间（透视投影）</a></li><li class="sidebar-sub-header"><a href="/fengyestudybase/Webgl/7-进入三维世界.html#八、正确处理对象的前后关系" class="sidebar-link">八、正确处理对象的前后关系</a></li><li class="sidebar-sub-header"><a href="/fengyestudybase/Webgl/7-进入三维世界.html#九、-立方体" class="sidebar-link">九、 立方体</a></li><li class="sidebar-sub-header"><a href="/fengyestudybase/Webgl/7-进入三维世界.html#十、为每个面指定颜色" class="sidebar-link">十、为每个面指定颜色</a></li></ul></li><li><a href="/fengyestudybase/Webgl/8-光照.html" class="sidebar-link">8-光照</a></li><li><a href="/fengyestudybase/Webgl/9-层次模型.html" class="sidebar-link">9-层次模型</a></li></ul></div></li></ul> </div> <div class="page"> <div class="content"><h1 id="_7-进入三维世界"><a href="#_7-进入三维世界" aria-hidden="true" class="header-anchor">#</a> 7-进入三维世界</h1> <h2 id="一、学习要点"><a href="#一、学习要点" aria-hidden="true" class="header-anchor">#</a> 一、学习要点</h2> <ol><li>以用户视角而进入三维世界</li> <li>控制三维可视空间</li> <li>裁剪</li> <li>处理物体的前后关系</li> <li>绘制三维立方体</li></ol> <h2 id="二、立方体由三角形构成"><a href="#二、立方体由三角形构成" aria-hidden="true" class="header-anchor">#</a> 二、立方体由三角形构成</h2> <p><img src="https://upload-images.jianshu.io/upload_images/10319049-b04174448ff53349.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="微信图片_20190426150340.png"></p> <p>12个三角形组成了一个立方体。既然三维物体由三角形组成，其实我们只需要像前面那样，逐个绘制组成物体的三角形就可以了吗？ <br>
三维物体与二维物体的一个显著区别：在二维中我们只需要考虑顶点的x y坐标而三维物体我们要考虑它的深度信息（depth information）。
为此我们要研究一下如何定义三维物体世界的观察者：</p> <ul><li>在什么地方看</li> <li>朝着那边开</li> <li>视野有多宽</li> <li>能看多远</li></ul> <h2 id="三、视点与视线"><a href="#三、视点与视线" aria-hidden="true" class="header-anchor">#</a> 三、视点与视线</h2> <blockquote><p>我们将观察者所处的位置称为视点，从视点触发沿着观察方向的射线称作视线。</p></blockquote> <h3 id="视点、观察模板点和上方向"><a href="#视点、观察模板点和上方向" aria-hidden="true" class="header-anchor">#</a> 视点、观察模板点和上方向</h3> <blockquote><p>为了确定观察值的状态，你需要获取两项信息： 视点，即管这种的位置。观察目标点（look-at point）,即被观察模板所在的点，他可以用来确定视线。此外 因为我们最后要把观察到的景象会知道屏幕上，还需要知道 上方向。</p></blockquote> <p><img src="https://upload-images.jianshu.io/upload_images/10319049-bd655430861c9634.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="微信图片_20190426151511.png"></p> <ul><li>视点：观察者所在的三维空间中的位置，视线的起点。视点坐标用（eyeX,eyeY,eyeZ）表示。</li> <li>观察目标点：被观察目标所在的点。视线从视点触发，穿过观察目标点并继续延伸。坐标表示为（atX,atY,atZ）.</li> <li>上方向：最终绘制在屏幕上的影响中的向上的方向。为了固定观察者防止它绕着视线为轴旋转。用（upX,upY,upZ）表示</li></ul> <p><img src="https://upload-images.jianshu.io/upload_images/10319049-4843092c72298be2.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="微信图片_20190426151958.png"></p> <p>利用上面三个矢量可以创建一个视图矩阵（view matrix）。然后将该矩阵传递顶点着色器。视图矩阵可以表示观察者的状态。
观察者默认状态应该是</p> <ul><li>视点位于坐标系统的原点（0,0,0）</li> <li>实现为Z轴负方向 观察点为（0,0,-1）</li> <li>上方向为Y轴的负方向 （0,1,0）</li></ul> <p>程序实例： 在三维空间中观察三角形</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 顶点着色器</span>
<span class="token keyword">var</span> <span class="token constant">VSHANER_SOURCE</span> <span class="token operator">=</span>
    <span class="token template-string"><span class="token string">`
        attribute vec4 a_Position;
        attribute vec4 a_Color;
        uniform mat4 u_ViewMatrix;
        varying vec4 v_Color;
        void main() {
            gl_Position = u_ViewMatrix * a_Position;
            v_Color = a_Color;
        }
    `</span></span><span class="token punctuation">;</span>
<span class="token comment">// 片元着色器</span>
<span class="token keyword">var</span> <span class="token constant">FSHADER_SOURCE</span> <span class="token operator">=</span>
<span class="token template-string"><span class="token string">`
    precision highp float; // 需要声明浮点数精度否则报错
    varying vec4 v_Color;
    void main() {
        gl_FragColor = v_Color;
    }
`</span></span>
<span class="token keyword">function</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> canvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'webgl'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> gl <span class="token operator">=</span> <span class="token function">getWebGLContext</span><span class="token punctuation">(</span>canvas<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>gl<span class="token punctuation">)</span><span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 初始化着色器</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">initShaders</span><span class="token punctuation">(</span>gl<span class="token punctuation">,</span><span class="token constant">VSHANER_SOURCE</span><span class="token punctuation">,</span><span class="token constant">FSHADER_SOURCE</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">var</span> n <span class="token operator">=</span> <span class="token function">initVertexBuffers</span><span class="token punctuation">(</span>gl<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>n<span class="token operator">&lt;</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;error&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">var</span> u_ViewMatrix <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getUniformLocation</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span>program<span class="token punctuation">,</span><span class="token string">'u_ViewMatrix'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 设置视点 视线 和上方向</span>
    <span class="token keyword">var</span> viewMatrix <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Matrix4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    viewMatrix<span class="token punctuation">.</span><span class="token function">setLookAt</span><span class="token punctuation">(</span><span class="token number">0.28</span><span class="token punctuation">,</span><span class="token number">0.25</span><span class="token punctuation">,</span><span class="token number">0.25</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 将试图矩阵传给 u_ViewMatrix变量</span>
    gl<span class="token punctuation">.</span><span class="token function">uniformMatrix4fv</span><span class="token punctuation">(</span>u_ViewMatrix<span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">,</span>viewMatrix<span class="token punctuation">.</span>elements<span class="token punctuation">)</span><span class="token punctuation">;</span>
    gl<span class="token punctuation">.</span><span class="token function">clearColor</span><span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span><span class="token number">0.0</span><span class="token punctuation">,</span><span class="token number">0.0</span><span class="token punctuation">,</span><span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    gl<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">COLOR_BUFFER_BIT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    gl<span class="token punctuation">.</span><span class="token function">drawArrays</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TRIANGLES</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>n<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">initVertexBuffers</span><span class="token punctuation">(</span>gl<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> verticesColors <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Float32Array</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
        <span class="token comment">// 顶点坐标和颜色</span>
        <span class="token number">0.0</span><span class="token punctuation">,</span><span class="token number">0.5</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">0.4</span><span class="token punctuation">,</span><span class="token number">0.4</span><span class="token punctuation">,</span><span class="token number">1.0</span><span class="token punctuation">,</span><span class="token number">0.4</span><span class="token punctuation">,</span>
        <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">0.4</span><span class="token punctuation">,</span><span class="token number">0.4</span><span class="token punctuation">,</span><span class="token number">1.0</span><span class="token punctuation">,</span><span class="token number">0.4</span><span class="token punctuation">,</span>
        <span class="token number">0.5</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">0.4</span><span class="token punctuation">,</span><span class="token number">1.0</span><span class="token punctuation">,</span><span class="token number">0.4</span><span class="token punctuation">,</span><span class="token number">0.4</span><span class="token punctuation">,</span> <span class="token comment">// 绿色三角形</span>

        <span class="token number">0.5</span><span class="token punctuation">,</span><span class="token number">0.4</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">0.2</span><span class="token punctuation">,</span><span class="token number">1.0</span><span class="token punctuation">,</span><span class="token number">0.4</span><span class="token punctuation">,</span><span class="token number">0.4</span><span class="token punctuation">,</span>
        <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span><span class="token number">0.4</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">0.2</span><span class="token punctuation">,</span><span class="token number">1.0</span><span class="token punctuation">,</span><span class="token number">1.0</span><span class="token punctuation">,</span><span class="token number">0.4</span><span class="token punctuation">,</span>
        <span class="token number">0.0</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">0.6</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">0.2</span><span class="token punctuation">,</span><span class="token number">1.0</span><span class="token punctuation">,</span><span class="token number">1.0</span><span class="token punctuation">,</span><span class="token number">0.4</span><span class="token punctuation">,</span> <span class="token comment">// 黄色三角形</span>

        <span class="token number">0.0</span><span class="token punctuation">,</span><span class="token number">0.5</span><span class="token punctuation">,</span><span class="token number">0.0</span><span class="token punctuation">,</span><span class="token number">0.4</span><span class="token punctuation">,</span><span class="token number">0.4</span><span class="token punctuation">,</span><span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token comment">// 蓝色三角形</span>
        <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span><span class="token number">0.5</span><span class="token punctuation">,</span><span class="token number">0.0</span><span class="token punctuation">,</span><span class="token number">0.4</span><span class="token punctuation">,</span><span class="token number">0.4</span><span class="token punctuation">,</span><span class="token number">1.0</span><span class="token punctuation">,</span>
        <span class="token number">0.5</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span><span class="token number">0.0</span><span class="token punctuation">,</span><span class="token number">1.0</span><span class="token punctuation">,</span><span class="token number">0.4</span><span class="token punctuation">,</span><span class="token number">0.4</span>
    <span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">var</span> n <span class="token operator">=</span> <span class="token number">9</span><span class="token punctuation">;</span>
    <span class="token comment">// 创建缓冲区对象</span>
    <span class="token keyword">var</span> vertexColorbuffer <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">createBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    gl<span class="token punctuation">.</span><span class="token function">bindBuffer</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span>vertexColorbuffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
    gl<span class="token punctuation">.</span><span class="token function">bufferData</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span>verticesColors<span class="token punctuation">,</span>gl<span class="token punctuation">.</span><span class="token constant">STATIC_DRAW</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> <span class="token constant">FSIZE</span> <span class="token operator">=</span> verticesColors<span class="token punctuation">.</span><span class="token constant">BYTES_PER_ELEMENT</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> a_Position <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getAttribLocation</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span>program<span class="token punctuation">,</span><span class="token string">'a_Position'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 将缓冲区对象分配给 a_Position变量</span>
    gl<span class="token punctuation">.</span><span class="token function">vertexAttribPointer</span><span class="token punctuation">(</span>a_Position<span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span>gl<span class="token punctuation">.</span><span class="token constant">FLOAT</span><span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token constant">FSIZE</span> <span class="token operator">*</span> <span class="token number">6</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    gl<span class="token punctuation">.</span><span class="token function">enableVertexAttribArray</span><span class="token punctuation">(</span>a_Position<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> a_Color <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getAttribLocation</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span>program<span class="token punctuation">,</span><span class="token string">'a_Color'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    gl<span class="token punctuation">.</span><span class="token function">vertexAttribPointer</span><span class="token punctuation">(</span>a_Color<span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span>gl<span class="token punctuation">.</span><span class="token constant">FLOAT</span><span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token constant">FSIZE</span> <span class="token operator">*</span> <span class="token number">6</span><span class="token punctuation">,</span><span class="token constant">FSIZE</span> <span class="token operator">*</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    gl<span class="token punctuation">.</span><span class="token function">enableVertexAttribArray</span><span class="token punctuation">(</span>a_Color<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> n<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><blockquote><p>视图矩阵与顶点矩阵相乘达到增加观察者的效果。 事实上 根据自定义的观察者状态 绘制观察者看到的景象 与 使用默认的观察状态，但是对三维对象进行评议 旋转等变化 在绘制观察者看到景象 这两种行为是等价的。</p></blockquote> <p><img src="https://upload-images.jianshu.io/upload_images/10319049-2cfee476e584477a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="微信图片_20190426163510.png"></p> <p>视点移动的方向与被观察对象（也就是整个世界）移动的方向正好相反。对于视点的旋转也可以采用类似的方式。</p> <h2 id="四-从指定视点观察旋转后的三角形"><a href="#四-从指定视点观察旋转后的三角形" aria-hidden="true" class="header-anchor">#</a> 四 从指定视点观察旋转后的三角形</h2> <p>我们需要两个矩阵： 旋转矩阵（表示三角形的旋转） 和 视图矩阵（表示观察世界的方式）。首先的问题是以怎么的顺序相乘两个矩阵。
我们需要先旋转三角形，然后从这个视点观察他。所以要先对三角形进行旋转变换，在对旋转后的三角形进行与“移动视点”等效的变化。我们按照上述顺序相乘矩阵。</p> <ul><li>&lt;旋转后顶点坐标&gt; = &lt;旋转矩阵&gt; x &lt;原始顶点坐标&gt;</li> <li>&lt;“从视点看上去” 的旋转后顶点坐标&gt; = &lt;视图矩阵&gt; x &lt;旋转后顶点坐标&gt;</li></ul> <p>模型矩阵：使用平移 缩放等基本变换或他们的组合组成的矩阵</p> <ul><li>&lt;“从视点看上去” 的旋转后顶点坐标&gt; = &lt;视图矩阵&gt; x &lt;模型矩阵&gt; x &lt;原始顶点坐标&gt;</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 顶点着色器</span>
<span class="token keyword">var</span> <span class="token constant">VSHANER_SOURCE</span> <span class="token operator">=</span>
    <span class="token template-string"><span class="token string">`
        attribute vec4 a_Position;
        attribute vec4 a_Color;
        uniform mat4 u_ViewMatrix;
        uniform mat4 u_ModelMatrix; // 增加了模型矩阵
        varying vec4 v_Color;
        void main() {
            gl_Position = u_ViewMatrix * u_ModelMatrix * a_Position;
            v_Color = a_Color;
        }
    `</span></span><span class="token punctuation">;</span>
<span class="token comment">// 片元着色器</span>
<span class="token keyword">var</span> <span class="token constant">FSHADER_SOURCE</span> <span class="token operator">=</span>
<span class="token template-string"><span class="token string">`
    precision highp float; // 需要声明浮点数精度否则报错
    varying vec4 v_Color;
    void main() {
        gl_FragColor = v_Color;
    }
`</span></span>
<span class="token keyword">function</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> canvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'webgl'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> gl <span class="token operator">=</span> <span class="token function">getWebGLContext</span><span class="token punctuation">(</span>canvas<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>gl<span class="token punctuation">)</span><span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 初始化着色器</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">initShaders</span><span class="token punctuation">(</span>gl<span class="token punctuation">,</span><span class="token constant">VSHANER_SOURCE</span><span class="token punctuation">,</span><span class="token constant">FSHADER_SOURCE</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">var</span> n <span class="token operator">=</span> <span class="token function">initVertexBuffers</span><span class="token punctuation">(</span>gl<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>n<span class="token operator">&lt;</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;error&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">var</span> u_ViewMatrix <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getUniformLocation</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span>program<span class="token punctuation">,</span><span class="token string">'u_ViewMatrix'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 设置视点 视线 和上方向</span>
    <span class="token keyword">var</span> viewMatrix <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Matrix4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    viewMatrix<span class="token punctuation">.</span><span class="token function">setLookAt</span><span class="token punctuation">(</span><span class="token number">0.28</span><span class="token punctuation">,</span><span class="token number">0.25</span><span class="token punctuation">,</span><span class="token number">0.25</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 将试图矩阵传给 u_ViewMatrix变量</span>
    gl<span class="token punctuation">.</span><span class="token function">uniformMatrix4fv</span><span class="token punctuation">(</span>u_ViewMatrix<span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">,</span>viewMatrix<span class="token punctuation">.</span>elements<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 模型矩阵赋值</span>
    <span class="token keyword">var</span> u_ModelMatrix <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getUniformLocation</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span>program<span class="token punctuation">,</span><span class="token string">'u_ModelMatrix'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> modelMatrix <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Matrix4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    modelMatrix<span class="token punctuation">.</span><span class="token function">setRotate</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    gl<span class="token punctuation">.</span><span class="token function">uniformMatrix4fv</span><span class="token punctuation">(</span>u_ModelMatrix<span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">,</span>modelMatrix<span class="token punctuation">.</span>elements<span class="token punctuation">)</span><span class="token punctuation">;</span>


    gl<span class="token punctuation">.</span><span class="token function">clearColor</span><span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span><span class="token number">0.0</span><span class="token punctuation">,</span><span class="token number">0.0</span><span class="token punctuation">,</span><span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    gl<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">COLOR_BUFFER_BIT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    gl<span class="token punctuation">.</span><span class="token function">drawArrays</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TRIANGLES</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>n<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">initVertexBuffers</span><span class="token punctuation">(</span>gl<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> verticesColors <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Float32Array</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
        <span class="token comment">// 顶点坐标和颜色</span>
        <span class="token number">0.0</span><span class="token punctuation">,</span><span class="token number">0.5</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">0.4</span><span class="token punctuation">,</span><span class="token number">0.4</span><span class="token punctuation">,</span><span class="token number">1.0</span><span class="token punctuation">,</span><span class="token number">0.4</span><span class="token punctuation">,</span>
        <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">0.4</span><span class="token punctuation">,</span><span class="token number">0.4</span><span class="token punctuation">,</span><span class="token number">1.0</span><span class="token punctuation">,</span><span class="token number">0.4</span><span class="token punctuation">,</span>
        <span class="token number">0.5</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">0.4</span><span class="token punctuation">,</span><span class="token number">1.0</span><span class="token punctuation">,</span><span class="token number">0.4</span><span class="token punctuation">,</span><span class="token number">0.4</span><span class="token punctuation">,</span> <span class="token comment">// 绿色三角形</span>

        <span class="token number">0.5</span><span class="token punctuation">,</span><span class="token number">0.4</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">0.2</span><span class="token punctuation">,</span><span class="token number">1.0</span><span class="token punctuation">,</span><span class="token number">0.4</span><span class="token punctuation">,</span><span class="token number">0.4</span><span class="token punctuation">,</span>
        <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span><span class="token number">0.4</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">0.2</span><span class="token punctuation">,</span><span class="token number">1.0</span><span class="token punctuation">,</span><span class="token number">1.0</span><span class="token punctuation">,</span><span class="token number">0.4</span><span class="token punctuation">,</span>
        <span class="token number">0.0</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">0.6</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">0.2</span><span class="token punctuation">,</span><span class="token number">1.0</span><span class="token punctuation">,</span><span class="token number">1.0</span><span class="token punctuation">,</span><span class="token number">0.4</span><span class="token punctuation">,</span> <span class="token comment">// 黄色三角形</span>

        <span class="token number">0.0</span><span class="token punctuation">,</span><span class="token number">0.5</span><span class="token punctuation">,</span><span class="token number">0.0</span><span class="token punctuation">,</span><span class="token number">0.4</span><span class="token punctuation">,</span><span class="token number">0.4</span><span class="token punctuation">,</span><span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token comment">// 蓝色三角形</span>
        <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span><span class="token number">0.5</span><span class="token punctuation">,</span><span class="token number">0.0</span><span class="token punctuation">,</span><span class="token number">0.4</span><span class="token punctuation">,</span><span class="token number">0.4</span><span class="token punctuation">,</span><span class="token number">1.0</span><span class="token punctuation">,</span>
        <span class="token number">0.5</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span><span class="token number">0.0</span><span class="token punctuation">,</span><span class="token number">1.0</span><span class="token punctuation">,</span><span class="token number">0.4</span><span class="token punctuation">,</span><span class="token number">0.4</span>
    <span class="token punctuation">]</span><span class="token punctuation">)</span>

    <span class="token keyword">var</span> n <span class="token operator">=</span> <span class="token number">9</span><span class="token punctuation">;</span>
    <span class="token comment">// 创建缓冲区对象</span>
    <span class="token keyword">var</span> vertexColorbuffer <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">createBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    gl<span class="token punctuation">.</span><span class="token function">bindBuffer</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span>vertexColorbuffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
    gl<span class="token punctuation">.</span><span class="token function">bufferData</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span>verticesColors<span class="token punctuation">,</span>gl<span class="token punctuation">.</span><span class="token constant">STATIC_DRAW</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> <span class="token constant">FSIZE</span> <span class="token operator">=</span> verticesColors<span class="token punctuation">.</span><span class="token constant">BYTES_PER_ELEMENT</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> a_Position <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getAttribLocation</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span>program<span class="token punctuation">,</span><span class="token string">'a_Position'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 将缓冲区对象分配给 a_Position变量</span>
    gl<span class="token punctuation">.</span><span class="token function">vertexAttribPointer</span><span class="token punctuation">(</span>a_Position<span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span>gl<span class="token punctuation">.</span><span class="token constant">FLOAT</span><span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token constant">FSIZE</span> <span class="token operator">*</span> <span class="token number">6</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    gl<span class="token punctuation">.</span><span class="token function">enableVertexAttribArray</span><span class="token punctuation">(</span>a_Position<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> a_Color <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getAttribLocation</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span>program<span class="token punctuation">,</span><span class="token string">'a_Color'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    gl<span class="token punctuation">.</span><span class="token function">vertexAttribPointer</span><span class="token punctuation">(</span>a_Color<span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span>gl<span class="token punctuation">.</span><span class="token constant">FLOAT</span><span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token constant">FSIZE</span> <span class="token operator">*</span> <span class="token number">6</span><span class="token punctuation">,</span><span class="token constant">FSIZE</span> <span class="token operator">*</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    gl<span class="token punctuation">.</span><span class="token function">enableVertexAttribArray</span><span class="token punctuation">(</span>a_Color<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> n<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><blockquote><p>这样的写法 程序对于每个顶点都要计算 视图矩阵 x 模型矩阵 这是不必要的性能开销。我们可以现在外面吧这两个矩阵相乘结果算出来 在给顶点着色器 这两个矩阵相乘得到的结果成为 模型视图矩阵（model view matrix）</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span>  modelViewMatrix <span class="token operator">=</span> viewMatrix<span class="token punctuation">.</span><span class="token function">multiply</span><span class="token punctuation">(</span>modelMatrix<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 实际上只需要一行代码就可以计算出模型视图矩阵了</span>
<span class="token keyword">var</span> modelViewMatrix <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Matrix4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
modelViewMatrix<span class="token punctuation">.</span><span class="token function">setLookAt</span><span class="token punctuation">(</span><span class="token number">0.20</span><span class="token punctuation">,</span><span class="token number">0.25</span><span class="token punctuation">,</span><span class="token number">0.25</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">rotate</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="五、利用键盘改变视点"><a href="#五、利用键盘改变视点" aria-hidden="true" class="header-anchor">#</a> 五、利用键盘改变视点</h2> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 顶点着色器</span>
<span class="token keyword">var</span> <span class="token constant">VSHANER_SOURCE</span> <span class="token operator">=</span>
    <span class="token template-string"><span class="token string">`
        attribute vec4 a_Position;
        attribute vec4 a_Color;
        uniform mat4 u_ViewMatrix;
        varying vec4 v_Color;
        void main() {
            gl_Position = u_ViewMatrix * a_Position;
            v_Color = a_Color;
        }
    `</span></span><span class="token punctuation">;</span>
<span class="token comment">// 片元着色器</span>
<span class="token keyword">var</span> <span class="token constant">FSHADER_SOURCE</span> <span class="token operator">=</span>
<span class="token template-string"><span class="token string">`
    precision highp float; // 需要声明浮点数精度否则报错
    varying vec4 v_Color;
    void main() {
        gl_FragColor = v_Color;
    }
`</span></span>
<span class="token keyword">function</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> canvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'webgl'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> gl <span class="token operator">=</span> <span class="token function">getWebGLContext</span><span class="token punctuation">(</span>canvas<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>gl<span class="token punctuation">)</span><span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 初始化着色器</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">initShaders</span><span class="token punctuation">(</span>gl<span class="token punctuation">,</span><span class="token constant">VSHANER_SOURCE</span><span class="token punctuation">,</span><span class="token constant">FSHADER_SOURCE</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">var</span> n <span class="token operator">=</span> <span class="token function">initVertexBuffers</span><span class="token punctuation">(</span>gl<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>n<span class="token operator">&lt;</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;error&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">var</span> u_ViewMatrix <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getUniformLocation</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span>program<span class="token punctuation">,</span><span class="token string">'u_ViewMatrix'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 设置视点 视线 和上方向</span>
    <span class="token keyword">var</span> viewMatrix <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Matrix4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 注册键盘事件响应函数</span>
    document<span class="token punctuation">.</span><span class="token function-variable function">onkeydown</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>ev<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">keydown</span><span class="token punctuation">(</span>ev<span class="token punctuation">,</span>gl<span class="token punctuation">,</span>n<span class="token punctuation">,</span>u_ViewMatrix<span class="token punctuation">,</span>viewMatrix<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token function">draw</span><span class="token punctuation">(</span>gl<span class="token punctuation">,</span>n<span class="token punctuation">,</span>u_ViewMatrix<span class="token punctuation">,</span>viewMatrix<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">initVertexBuffers</span><span class="token punctuation">(</span>gl<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> verticesColors <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Float32Array</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
        <span class="token comment">// 顶点坐标和颜色</span>
        <span class="token number">0.0</span><span class="token punctuation">,</span><span class="token number">0.5</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">0.4</span><span class="token punctuation">,</span><span class="token number">0.4</span><span class="token punctuation">,</span><span class="token number">1.0</span><span class="token punctuation">,</span><span class="token number">0.4</span><span class="token punctuation">,</span>
        <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">0.4</span><span class="token punctuation">,</span><span class="token number">0.4</span><span class="token punctuation">,</span><span class="token number">1.0</span><span class="token punctuation">,</span><span class="token number">0.4</span><span class="token punctuation">,</span>
        <span class="token number">0.5</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">0.4</span><span class="token punctuation">,</span><span class="token number">1.0</span><span class="token punctuation">,</span><span class="token number">0.4</span><span class="token punctuation">,</span><span class="token number">0.4</span><span class="token punctuation">,</span> <span class="token comment">// 绿色三角形</span>

        <span class="token number">0.5</span><span class="token punctuation">,</span><span class="token number">0.4</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">0.2</span><span class="token punctuation">,</span><span class="token number">1.0</span><span class="token punctuation">,</span><span class="token number">0.4</span><span class="token punctuation">,</span><span class="token number">0.4</span><span class="token punctuation">,</span>
        <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span><span class="token number">0.4</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">0.2</span><span class="token punctuation">,</span><span class="token number">1.0</span><span class="token punctuation">,</span><span class="token number">1.0</span><span class="token punctuation">,</span><span class="token number">0.4</span><span class="token punctuation">,</span>
        <span class="token number">0.0</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">0.6</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">0.2</span><span class="token punctuation">,</span><span class="token number">1.0</span><span class="token punctuation">,</span><span class="token number">1.0</span><span class="token punctuation">,</span><span class="token number">0.4</span><span class="token punctuation">,</span> <span class="token comment">// 黄色三角形</span>

        <span class="token number">0.0</span><span class="token punctuation">,</span><span class="token number">0.5</span><span class="token punctuation">,</span><span class="token number">0.0</span><span class="token punctuation">,</span><span class="token number">0.4</span><span class="token punctuation">,</span><span class="token number">0.4</span><span class="token punctuation">,</span><span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token comment">// 蓝色三角形</span>
        <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span><span class="token number">0.5</span><span class="token punctuation">,</span><span class="token number">0.0</span><span class="token punctuation">,</span><span class="token number">0.4</span><span class="token punctuation">,</span><span class="token number">0.4</span><span class="token punctuation">,</span><span class="token number">1.0</span><span class="token punctuation">,</span>
        <span class="token number">0.5</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span><span class="token number">0.0</span><span class="token punctuation">,</span><span class="token number">1.0</span><span class="token punctuation">,</span><span class="token number">0.4</span><span class="token punctuation">,</span><span class="token number">0.4</span>
    <span class="token punctuation">]</span><span class="token punctuation">)</span>

    <span class="token keyword">var</span> n <span class="token operator">=</span> <span class="token number">9</span><span class="token punctuation">;</span>
    <span class="token comment">// 创建缓冲区对象</span>
    <span class="token keyword">var</span> vertexColorbuffer <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">createBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    gl<span class="token punctuation">.</span><span class="token function">bindBuffer</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span>vertexColorbuffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
    gl<span class="token punctuation">.</span><span class="token function">bufferData</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span>verticesColors<span class="token punctuation">,</span>gl<span class="token punctuation">.</span><span class="token constant">STATIC_DRAW</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> <span class="token constant">FSIZE</span> <span class="token operator">=</span> verticesColors<span class="token punctuation">.</span><span class="token constant">BYTES_PER_ELEMENT</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> a_Position <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getAttribLocation</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span>program<span class="token punctuation">,</span><span class="token string">'a_Position'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 将缓冲区对象分配给 a_Position变量</span>
    gl<span class="token punctuation">.</span><span class="token function">vertexAttribPointer</span><span class="token punctuation">(</span>a_Position<span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span>gl<span class="token punctuation">.</span><span class="token constant">FLOAT</span><span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token constant">FSIZE</span> <span class="token operator">*</span> <span class="token number">6</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    gl<span class="token punctuation">.</span><span class="token function">enableVertexAttribArray</span><span class="token punctuation">(</span>a_Position<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> a_Color <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getAttribLocation</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span>program<span class="token punctuation">,</span><span class="token string">'a_Color'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    gl<span class="token punctuation">.</span><span class="token function">vertexAttribPointer</span><span class="token punctuation">(</span>a_Color<span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span>gl<span class="token punctuation">.</span><span class="token constant">FLOAT</span><span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token constant">FSIZE</span> <span class="token operator">*</span> <span class="token number">6</span><span class="token punctuation">,</span><span class="token constant">FSIZE</span> <span class="token operator">*</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    gl<span class="token punctuation">.</span><span class="token function">enableVertexAttribArray</span><span class="token punctuation">(</span>a_Color<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> n<span class="token punctuation">;</span>
<span class="token punctuation">}</span>


<span class="token keyword">var</span> g_eyeX <span class="token operator">=</span> <span class="token number">0.20</span><span class="token punctuation">,</span>g_eyeY<span class="token operator">=</span><span class="token number">0.25</span><span class="token punctuation">,</span>g_eyeZ<span class="token operator">=</span><span class="token number">0.25</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">keydown</span><span class="token punctuation">(</span>ev<span class="token punctuation">,</span>gl<span class="token punctuation">,</span>n<span class="token punctuation">,</span>u_ViewMatrix<span class="token punctuation">,</span>viewMatrix<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>ev<span class="token punctuation">.</span>keyCode <span class="token operator">==</span> <span class="token number">39</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">// 按下右键</span>
        g_eyeX <span class="token operator">+=</span> <span class="token number">0.01</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>ev<span class="token punctuation">.</span>keyCode <span class="token operator">==</span> <span class="token number">37</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">// 按下左键</span>
        g_eyeX <span class="token operator">-=</span> <span class="token number">0.01</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
        <span class="token comment">//按下其他键</span>
        <span class="token keyword">return</span> <span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">draw</span><span class="token punctuation">(</span>gl<span class="token punctuation">,</span>n<span class="token punctuation">,</span>u_ViewMatrix<span class="token punctuation">,</span>viewMatrix<span class="token punctuation">)</span>
<span class="token punctuation">}</span>


<span class="token keyword">function</span> <span class="token function">draw</span><span class="token punctuation">(</span>gl<span class="token punctuation">,</span>n<span class="token punctuation">,</span>u_ViewMatrix<span class="token punctuation">,</span>viewMatrix<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 设置视点和视线</span>
    viewMatrix<span class="token punctuation">.</span><span class="token function">setLookAt</span><span class="token punctuation">(</span>g_eyeX<span class="token punctuation">,</span>g_eyeY<span class="token punctuation">,</span>g_eyeZ<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 将试图矩阵传给 u_ViewMatrix变量</span>
    gl<span class="token punctuation">.</span><span class="token function">uniformMatrix4fv</span><span class="token punctuation">(</span>u_ViewMatrix<span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">,</span>viewMatrix<span class="token punctuation">.</span>elements<span class="token punctuation">)</span><span class="token punctuation">;</span>
    gl<span class="token punctuation">.</span><span class="token function">clearColor</span><span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span><span class="token number">0.0</span><span class="token punctuation">,</span><span class="token number">0.0</span><span class="token punctuation">,</span><span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    gl<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">COLOR_BUFFER_BIT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    gl<span class="token punctuation">.</span><span class="token function">drawArrays</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TRIANGLES</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>n<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre></div><h2 id="六、可视范围（正射类型）"><a href="#六、可视范围（正射类型）" aria-hidden="true" class="header-anchor">#</a> 六、可视范围（正射类型）</h2> <p>只有当三维物体卡再可视范围内时 webGL才会绘制它。</p> <ul><li>可视空间分为两类</li></ul> <ol><li>长方形可视空间，也成盒装空间，由正射投影（orthographic projection）产生。</li> <li>四棱锥/ 金字塔可视空间，由透视投影（perspective projection）产生。</li></ol> <p>基于正射投影的盒装可视空间的工作原理：盒装可视空间的由前后两个矩形表面确定，分别称为近裁剪面和远裁剪面。</p> <p><img src="https://upload-images.jianshu.io/upload_images/10319049-76c8624f2b74d6ff.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="微信图片_20190426175430.png"></p> <blockquote><p>定义盒装可视空间
cuon-matrix.js中提供了Matrix4.setOrtho()方法用来设置投影矩阵，定义盒装可视空间。
<img src="https://upload-images.jianshu.io/upload_images/10319049-848aa140332ee740.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="微信图片_20190426175701.png">
通过示例程序展示正射投影矩阵的使用方法和效果。</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code>    <span class="token comment">// 可以使用方向键操作投影盒子的近裁剪面 和 远裁剪面</span>

    <span class="token comment">// 顶点着色器</span>
<span class="token keyword">var</span> <span class="token constant">VSHANER_SOURCE</span> <span class="token operator">=</span>
    <span class="token template-string"><span class="token string">`
        attribute vec4 a_Position;
        attribute vec4 a_Color;
        uniform mat4 u_ProjMatrix;
        varying vec4 v_Color;
        void main() {
            gl_Position = u_ProjMatrix * a_Position;
            v_Color = a_Color;
        }
    `</span></span><span class="token punctuation">;</span>
<span class="token comment">// 片元着色器</span>
<span class="token keyword">var</span> <span class="token constant">FSHADER_SOURCE</span> <span class="token operator">=</span>
<span class="token template-string"><span class="token string">`
    precision highp float; // 需要声明浮点数精度否则报错
    varying vec4 v_Color;
    void main() {
        gl_FragColor = v_Color;
    }
`</span></span>
<span class="token keyword">function</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> canvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'webgl'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 获取nearFar元素</span>
    <span class="token keyword">var</span> nf <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'nearFar'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> gl <span class="token operator">=</span> <span class="token function">getWebGLContext</span><span class="token punctuation">(</span>canvas<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>gl<span class="token punctuation">)</span><span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 初始化着色器</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">initShaders</span><span class="token punctuation">(</span>gl<span class="token punctuation">,</span><span class="token constant">VSHANER_SOURCE</span><span class="token punctuation">,</span><span class="token constant">FSHADER_SOURCE</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">var</span> n <span class="token operator">=</span> <span class="token function">initVertexBuffers</span><span class="token punctuation">(</span>gl<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>n<span class="token operator">&lt;</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;error&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">var</span> u_ProjMatrix <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getUniformLocation</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span>program<span class="token punctuation">,</span><span class="token string">'u_ProjMatrix'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 设置视点 视线 和上方向</span>
    <span class="token keyword">var</span> projMatrix <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Matrix4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 注册键盘事件响应函数</span>
    document<span class="token punctuation">.</span><span class="token function-variable function">onkeydown</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>ev<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">keydown</span><span class="token punctuation">(</span>ev<span class="token punctuation">,</span>gl<span class="token punctuation">,</span>n<span class="token punctuation">,</span>u_ProjMatrix<span class="token punctuation">,</span>projMatrix<span class="token punctuation">,</span>nf<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token function">draw</span><span class="token punctuation">(</span>gl<span class="token punctuation">,</span>n<span class="token punctuation">,</span>u_ProjMatrix<span class="token punctuation">,</span>projMatrix<span class="token punctuation">,</span>nf<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// 视点与 近 远裁剪面的距离</span>
<span class="token keyword">var</span> g_near <span class="token operator">=</span> <span class="token number">0.0</span><span class="token punctuation">,</span> g_far <span class="token operator">=</span> <span class="token number">0.5</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">keydown</span><span class="token punctuation">(</span>ev<span class="token punctuation">,</span>gl<span class="token punctuation">,</span>n<span class="token punctuation">,</span>u_ProjMatrix<span class="token punctuation">,</span>projMatrix<span class="token punctuation">,</span>nf<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">switch</span> <span class="token punctuation">(</span>ev<span class="token punctuation">.</span>keyCode<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">case</span> <span class="token number">39</span><span class="token punctuation">:</span> g_near <span class="token operator">+=</span><span class="token number">0.01</span><span class="token punctuation">;</span><span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token comment">//右方向</span>
        <span class="token keyword">case</span> <span class="token number">37</span><span class="token punctuation">:</span> g_near <span class="token operator">-=</span><span class="token number">0.01</span><span class="token punctuation">;</span><span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token comment">//左方向</span>
        <span class="token keyword">case</span> <span class="token number">38</span><span class="token punctuation">:</span> g_far <span class="token operator">+=</span><span class="token number">0.01</span><span class="token punctuation">;</span><span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token comment">//上方向</span>
        <span class="token keyword">case</span> <span class="token number">40</span><span class="token punctuation">:</span> g_far <span class="token operator">-=</span><span class="token number">0.01</span><span class="token punctuation">;</span><span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token comment">//下方向</span>
        <span class="token keyword">default</span><span class="token punctuation">:</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">draw</span><span class="token punctuation">(</span>gl<span class="token punctuation">,</span>n<span class="token punctuation">,</span>u_ProjMatrix<span class="token punctuation">,</span>projMatrix<span class="token punctuation">,</span>nf<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">draw</span><span class="token punctuation">(</span>gl<span class="token punctuation">,</span>n<span class="token punctuation">,</span>u_ProjMatrix<span class="token punctuation">,</span>projMatrix<span class="token punctuation">,</span>nf<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    projMatrix<span class="token punctuation">.</span><span class="token function">setOrtho</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span>g_near<span class="token punctuation">,</span>g_far<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 将投影矩阵传递给u_ProjMatrix变量</span>
    gl<span class="token punctuation">.</span><span class="token function">uniformMatrix4fv</span><span class="token punctuation">(</span>u_ProjMatrix<span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">,</span>projMatrix<span class="token punctuation">.</span>elements<span class="token punctuation">)</span><span class="token punctuation">;</span>
    gl<span class="token punctuation">.</span><span class="token function">clearColor</span><span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span><span class="token number">0.0</span><span class="token punctuation">,</span><span class="token number">0.0</span><span class="token punctuation">,</span><span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    gl<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">COLOR_BUFFER_BIT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    nf<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token string">'near:'</span><span class="token operator">+</span>Math<span class="token punctuation">.</span><span class="token function">round</span><span class="token punctuation">(</span>g_near<span class="token operator">*</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">100</span> <span class="token operator">+</span> <span class="token string">', far:'</span><span class="token operator">+</span>Math<span class="token punctuation">.</span><span class="token function">round</span><span class="token punctuation">(</span>g_far<span class="token operator">*</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">100</span><span class="token punctuation">;</span>
    gl<span class="token punctuation">.</span><span class="token function">drawArrays</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TRIANGLES</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>n<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><blockquote><p>改变     projMatrix.setOrtho(-0.3,0.3,-1.0,1.0,g_near,g_far); 可以投影出不同的三角形</p></blockquote> <h2 id="七、可视空间（透视投影）"><a href="#七、可视空间（透视投影）" aria-hidden="true" class="header-anchor">#</a> 七、可视空间（透视投影）</h2> <p>使用透视空间可以使大的画出的图形具有深度感。从图上可以看出随着Z轴的变化 相同大小的三角形会越来越小
<img src="https://upload-images.jianshu.io/upload_images/10319049-ee259d231114cf2f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="微信图片_20190430172702.png"></p> <p>透视投影可视空间的定义：</p> <p><img src="https://upload-images.jianshu.io/upload_images/10319049-ce1a5437155ae4ac.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="微信图片_20190430173011.png"></p> <p><img src="https://upload-images.jianshu.io/upload_images/10319049-b13226054b33df7a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="微信图片_20190430173021.png"></p> <blockquote><p>采用setPerspective()函数定义透视投影矩阵。
示例程序如下</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 顶点着色器</span>
<span class="token keyword">var</span> <span class="token constant">VSHANER_SOURCE</span> <span class="token operator">=</span>
    <span class="token template-string"><span class="token string">`
        attribute vec4 a_Position;
        attribute vec4 a_Color;
        uniform mat4 u_ViewMatrix;
        uniform mat4 u_ProMatrix;
        varying vec4 v_Color;
        void main() {
            gl_Position =u_ProMatrix *  u_ViewMatrix * a_Position;
            v_Color = a_Color;
        }
    `</span></span><span class="token punctuation">;</span>
<span class="token comment">// 片元着色器</span>
<span class="token keyword">var</span> <span class="token constant">FSHADER_SOURCE</span> <span class="token operator">=</span>
<span class="token template-string"><span class="token string">`
    precision highp float; // 需要声明浮点数精度否则报错
    varying vec4 v_Color;
    void main() {
        gl_FragColor = v_Color;
    }
`</span></span>
<span class="token keyword">function</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> canvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'webgl'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> gl <span class="token operator">=</span> <span class="token function">getWebGLContext</span><span class="token punctuation">(</span>canvas<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>gl<span class="token punctuation">)</span><span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 初始化着色器</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">initShaders</span><span class="token punctuation">(</span>gl<span class="token punctuation">,</span><span class="token constant">VSHANER_SOURCE</span><span class="token punctuation">,</span><span class="token constant">FSHADER_SOURCE</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">var</span> n <span class="token operator">=</span> <span class="token function">initVertexBuffers</span><span class="token punctuation">(</span>gl<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>n<span class="token operator">&lt;</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;error&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">var</span> u_ViewMatrix <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getUniformLocation</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span>program<span class="token punctuation">,</span><span class="token string">'u_ViewMatrix'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> u_ProMatrix <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getUniformLocation</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span>program<span class="token punctuation">,</span><span class="token string">'u_ProMatrix'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 设置视点 视线 和上方向</span>
    <span class="token keyword">var</span> viewMatrix <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Matrix4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 投影矩阵</span>
    <span class="token keyword">var</span> projMatrix <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Matrix4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 计算视图矩阵和投影矩阵</span>
    viewMatrix<span class="token punctuation">.</span><span class="token function">setLookAt</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//第二个参数aspect宽高比应该与 canvas保持一致，我们根据canvas的 width和height属性来计算出该参数。从而使得canvas大小发生变化也不会导致显示出来的图变形</span>
    projMatrix<span class="token punctuation">.</span><span class="token function">setPerspective</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">,</span>canvas<span class="token punctuation">.</span>width<span class="token operator">/</span>canvas<span class="token punctuation">.</span>height<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 将试图矩阵和投影矩阵传递给参数</span>
    gl<span class="token punctuation">.</span><span class="token function">uniformMatrix4fv</span><span class="token punctuation">(</span>u_ViewMatrix<span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">,</span>viewMatrix<span class="token punctuation">.</span>elements<span class="token punctuation">)</span><span class="token punctuation">;</span>
    gl<span class="token punctuation">.</span><span class="token function">uniformMatrix4fv</span><span class="token punctuation">(</span>u_ProMatrix<span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">,</span>projMatrix<span class="token punctuation">.</span>elements<span class="token punctuation">)</span><span class="token punctuation">;</span>
    gl<span class="token punctuation">.</span><span class="token function">clearColor</span><span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span><span class="token number">0.0</span><span class="token punctuation">,</span><span class="token number">0.0</span><span class="token punctuation">,</span><span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    gl<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">COLOR_BUFFER_BIT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    gl<span class="token punctuation">.</span><span class="token function">drawArrays</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TRIANGLES</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>n<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">initVertexBuffers</span><span class="token punctuation">(</span>gl<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> verticesColors <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Float32Array</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
        <span class="token comment">// 右侧的3个三角形</span>
        <span class="token number">0.75</span><span class="token punctuation">,</span><span class="token number">1.0</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">4.0</span><span class="token punctuation">,</span><span class="token number">0.4</span><span class="token punctuation">,</span><span class="token number">1.0</span><span class="token punctuation">,</span><span class="token number">0.4</span><span class="token punctuation">,</span>
        <span class="token number">0.25</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">1.0</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">4.0</span><span class="token punctuation">,</span><span class="token number">0.4</span><span class="token punctuation">,</span><span class="token number">1.0</span><span class="token punctuation">,</span><span class="token number">0.4</span><span class="token punctuation">,</span>
        <span class="token number">1.25</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">1.0</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">4.0</span><span class="token punctuation">,</span><span class="token number">1.0</span><span class="token punctuation">,</span><span class="token number">0.4</span><span class="token punctuation">,</span><span class="token number">0.4</span><span class="token punctuation">,</span>

        <span class="token number">0.75</span><span class="token punctuation">,</span><span class="token number">1.0</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">2.0</span><span class="token punctuation">,</span><span class="token number">1.0</span><span class="token punctuation">,</span><span class="token number">1.0</span><span class="token punctuation">,</span><span class="token number">0.4</span><span class="token punctuation">,</span>
        <span class="token number">0.25</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">1.0</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">2.0</span><span class="token punctuation">,</span><span class="token number">1.0</span><span class="token punctuation">,</span><span class="token number">1.0</span><span class="token punctuation">,</span><span class="token number">0.4</span><span class="token punctuation">,</span>
        <span class="token number">1.25</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">1.0</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">2.0</span><span class="token punctuation">,</span><span class="token number">1.0</span><span class="token punctuation">,</span><span class="token number">0.4</span><span class="token punctuation">,</span><span class="token number">0.4</span><span class="token punctuation">,</span>

        <span class="token number">0.75</span><span class="token punctuation">,</span><span class="token number">1.0</span><span class="token punctuation">,</span><span class="token number">0.0</span><span class="token punctuation">,</span><span class="token number">0.4</span><span class="token punctuation">,</span><span class="token number">0.4</span><span class="token punctuation">,</span><span class="token number">1.0</span><span class="token punctuation">,</span>
        <span class="token number">0.25</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">1.0</span><span class="token punctuation">,</span><span class="token number">0.0</span><span class="token punctuation">,</span><span class="token number">0.4</span><span class="token punctuation">,</span><span class="token number">0.4</span><span class="token punctuation">,</span><span class="token number">1.0</span><span class="token punctuation">,</span>
        <span class="token number">1.25</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">1.0</span><span class="token punctuation">,</span><span class="token number">0.0</span><span class="token punctuation">,</span><span class="token number">1.0</span><span class="token punctuation">,</span><span class="token number">0.4</span><span class="token punctuation">,</span><span class="token number">0.4</span><span class="token punctuation">,</span>

        <span class="token comment">// 左侧的3个三角形</span>
        <span class="token operator">-</span><span class="token number">0.75</span><span class="token punctuation">,</span><span class="token number">1.0</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">4.0</span><span class="token punctuation">,</span><span class="token number">0.4</span><span class="token punctuation">,</span><span class="token number">1.0</span><span class="token punctuation">,</span><span class="token number">0.4</span><span class="token punctuation">,</span>
        <span class="token operator">-</span><span class="token number">1.25</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">1.0</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">4.0</span><span class="token punctuation">,</span><span class="token number">0.4</span><span class="token punctuation">,</span><span class="token number">1.0</span><span class="token punctuation">,</span><span class="token number">0.4</span><span class="token punctuation">,</span>
        <span class="token operator">-</span><span class="token number">0.25</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">1.0</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">4.0</span><span class="token punctuation">,</span><span class="token number">1.0</span><span class="token punctuation">,</span><span class="token number">0.4</span><span class="token punctuation">,</span><span class="token number">0.4</span><span class="token punctuation">,</span>

        <span class="token operator">-</span><span class="token number">0.75</span><span class="token punctuation">,</span><span class="token number">1.0</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">2.0</span><span class="token punctuation">,</span><span class="token number">1.0</span><span class="token punctuation">,</span><span class="token number">1.0</span><span class="token punctuation">,</span><span class="token number">0.4</span><span class="token punctuation">,</span>
        <span class="token operator">-</span><span class="token number">1.25</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">1.0</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">2.0</span><span class="token punctuation">,</span><span class="token number">1.0</span><span class="token punctuation">,</span><span class="token number">1.0</span><span class="token punctuation">,</span><span class="token number">0.4</span><span class="token punctuation">,</span>
        <span class="token operator">-</span><span class="token number">0.25</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">1.0</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">2.0</span><span class="token punctuation">,</span><span class="token number">1.0</span><span class="token punctuation">,</span><span class="token number">0.4</span><span class="token punctuation">,</span><span class="token number">0.4</span><span class="token punctuation">,</span>

        <span class="token operator">-</span><span class="token number">0.75</span><span class="token punctuation">,</span><span class="token number">1.0</span><span class="token punctuation">,</span><span class="token number">0.0</span><span class="token punctuation">,</span><span class="token number">0.4</span><span class="token punctuation">,</span><span class="token number">0.4</span><span class="token punctuation">,</span><span class="token number">1.0</span><span class="token punctuation">,</span>
        <span class="token operator">-</span><span class="token number">1.25</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">1.0</span><span class="token punctuation">,</span><span class="token number">0.0</span><span class="token punctuation">,</span><span class="token number">0.4</span><span class="token punctuation">,</span><span class="token number">0.4</span><span class="token punctuation">,</span><span class="token number">1.0</span><span class="token punctuation">,</span>
        <span class="token operator">-</span><span class="token number">0.25</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">1.0</span><span class="token punctuation">,</span><span class="token number">0.0</span><span class="token punctuation">,</span><span class="token number">1.0</span><span class="token punctuation">,</span><span class="token number">0.4</span><span class="token punctuation">,</span><span class="token number">0.4</span><span class="token punctuation">,</span>

    <span class="token punctuation">]</span><span class="token punctuation">)</span>

    <span class="token keyword">var</span> n <span class="token operator">=</span> <span class="token number">18</span><span class="token punctuation">;</span>
    <span class="token comment">// 创建缓冲区对象</span>
    <span class="token keyword">var</span> vertexColorbuffer <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">createBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    gl<span class="token punctuation">.</span><span class="token function">bindBuffer</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span>vertexColorbuffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
    gl<span class="token punctuation">.</span><span class="token function">bufferData</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span>verticesColors<span class="token punctuation">,</span>gl<span class="token punctuation">.</span><span class="token constant">STATIC_DRAW</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> <span class="token constant">FSIZE</span> <span class="token operator">=</span> verticesColors<span class="token punctuation">.</span><span class="token constant">BYTES_PER_ELEMENT</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> a_Position <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getAttribLocation</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span>program<span class="token punctuation">,</span><span class="token string">'a_Position'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 将缓冲区对象分配给 a_Position变量</span>
    gl<span class="token punctuation">.</span><span class="token function">vertexAttribPointer</span><span class="token punctuation">(</span>a_Position<span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span>gl<span class="token punctuation">.</span><span class="token constant">FLOAT</span><span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token constant">FSIZE</span> <span class="token operator">*</span> <span class="token number">6</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    gl<span class="token punctuation">.</span><span class="token function">enableVertexAttribArray</span><span class="token punctuation">(</span>a_Position<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> a_Color <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getAttribLocation</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span>program<span class="token punctuation">,</span><span class="token string">'a_Color'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    gl<span class="token punctuation">.</span><span class="token function">vertexAttribPointer</span><span class="token punctuation">(</span>a_Color<span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span>gl<span class="token punctuation">.</span><span class="token constant">FLOAT</span><span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token constant">FSIZE</span> <span class="token operator">*</span> <span class="token number">6</span><span class="token punctuation">,</span><span class="token constant">FSIZE</span> <span class="token operator">*</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    gl<span class="token punctuation">.</span><span class="token function">enableVertexAttribArray</span><span class="token punctuation">(</span>a_Color<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> n<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="投影矩阵的作用（矩阵为什么可以定义可是空间）"><a href="#投影矩阵的作用（矩阵为什么可以定义可是空间）" aria-hidden="true" class="header-anchor">#</a> 投影矩阵的作用（矩阵为什么可以定义可是空间）</h3> <ul><li>我们看到三角形看上去变小了，也在被不同程度的想着中心新（视线）平移，使得看上去在视线的左右排成了两列。实际上这些三角形完全是相同的，透视矩阵对三小型进行了两次变换：<br>
（1） 根据三小型与视点的距离，按比例对三角形进行了缩小变换；<br>
（2） 对三角形进行偏移变换。</li></ul> <blockquote><p>这表明可是空间的规范可以用一系列基本变换（如平移，缩放）来定义。</p></blockquote> <h3 id="一个模型矩阵，视图矩阵和投影矩阵的综合例子"><a href="#一个模型矩阵，视图矩阵和投影矩阵的综合例子" aria-hidden="true" class="header-anchor">#</a> 一个模型矩阵，视图矩阵和投影矩阵的综合例子</h3> <p>我们上面敲了六个三角形的顶点，真是太繁琐了，如何能比较高效的实现呢？</p> <ol><li>沿着Z轴准备三个三角形的顶点数据</li> <li>将其沿着X轴正方向平移0.75单位，绘制这些三角形</li> <li>将其沿着X轴负方向平移0.75单位，绘制这些三角形</li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 顶点着色器</span>
<span class="token keyword">var</span> <span class="token constant">VSHANER_SOURCE</span> <span class="token operator">=</span>
    <span class="token template-string"><span class="token string">`
        attribute vec4 a_Position;
        attribute vec4 a_Color;
        uniform mat4 u_ModelMatrix;
        uniform mat4 u_ViewMatrix;
        uniform mat4 u_ProMatrix;
        varying vec4 v_Color;
        void main() {
            gl_Position =u_ProMatrix *  u_ViewMatrix * u_ModelMatrix * a_Position;
            v_Color = a_Color;
        }
    `</span></span><span class="token punctuation">;</span>
<span class="token comment">// 片元着色器</span>
<span class="token keyword">var</span> <span class="token constant">FSHADER_SOURCE</span> <span class="token operator">=</span>
<span class="token template-string"><span class="token string">`
    precision highp float; // 需要声明浮点数精度否则报错
    varying vec4 v_Color;
    void main() {
        gl_FragColor = v_Color;
    }
`</span></span>
<span class="token keyword">function</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> canvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'webgl'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> gl <span class="token operator">=</span> <span class="token function">getWebGLContext</span><span class="token punctuation">(</span>canvas<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>gl<span class="token punctuation">)</span><span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 初始化着色器</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">initShaders</span><span class="token punctuation">(</span>gl<span class="token punctuation">,</span><span class="token constant">VSHANER_SOURCE</span><span class="token punctuation">,</span><span class="token constant">FSHADER_SOURCE</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">var</span> n <span class="token operator">=</span> <span class="token function">initVertexBuffers</span><span class="token punctuation">(</span>gl<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>n<span class="token operator">&lt;</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;error&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">var</span> u_ModelMatrix <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getUniformLocation</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span>program<span class="token punctuation">,</span><span class="token string">'u_ModelMatrix'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> u_ViewMatrix <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getUniformLocation</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span>program<span class="token punctuation">,</span><span class="token string">'u_ViewMatrix'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> u_ProMatrix <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getUniformLocation</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span>program<span class="token punctuation">,</span><span class="token string">'u_ProMatrix'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 模型矩阵</span>
    <span class="token keyword">var</span> modelMatrix <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Matrix4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 设置视点 视线 和上方向</span>
    <span class="token keyword">var</span> viewMatrix <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Matrix4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 投影矩阵</span>
    <span class="token keyword">var</span> projMatrix <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Matrix4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 计算视图矩阵和投影矩阵</span>
    modelMatrix<span class="token punctuation">.</span><span class="token function">setTranslate</span><span class="token punctuation">(</span><span class="token number">0.75</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 平移0.75单位</span>
    viewMatrix<span class="token punctuation">.</span><span class="token function">setLookAt</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">200</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    projMatrix<span class="token punctuation">.</span><span class="token function">setPerspective</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">,</span>canvas<span class="token punctuation">.</span>width<span class="token operator">/</span>canvas<span class="token punctuation">.</span>height<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 将试图矩阵和投影矩阵传递给参数</span>
    gl<span class="token punctuation">.</span><span class="token function">uniformMatrix4fv</span><span class="token punctuation">(</span>u_ModelMatrix<span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">,</span>modelMatrix<span class="token punctuation">.</span>elements<span class="token punctuation">)</span><span class="token punctuation">;</span>
    gl<span class="token punctuation">.</span><span class="token function">uniformMatrix4fv</span><span class="token punctuation">(</span>u_ViewMatrix<span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">,</span>viewMatrix<span class="token punctuation">.</span>elements<span class="token punctuation">)</span><span class="token punctuation">;</span>
    gl<span class="token punctuation">.</span><span class="token function">uniformMatrix4fv</span><span class="token punctuation">(</span>u_ProMatrix<span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">,</span>projMatrix<span class="token punctuation">.</span>elements<span class="token punctuation">)</span><span class="token punctuation">;</span>
    gl<span class="token punctuation">.</span><span class="token function">clearColor</span><span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span><span class="token number">0.0</span><span class="token punctuation">,</span><span class="token number">0.0</span><span class="token punctuation">,</span><span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    gl<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">COLOR_BUFFER_BIT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    gl<span class="token punctuation">.</span><span class="token function">drawArrays</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TRIANGLES</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>n<span class="token punctuation">)</span><span class="token punctuation">;</span>

    modelMatrix<span class="token punctuation">.</span><span class="token function">setTranslate</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">0.75</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    gl<span class="token punctuation">.</span><span class="token function">uniformMatrix4fv</span><span class="token punctuation">(</span>u_ModelMatrix<span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">,</span>modelMatrix<span class="token punctuation">.</span>elements<span class="token punctuation">)</span><span class="token punctuation">;</span>
    gl<span class="token punctuation">.</span><span class="token function">drawArrays</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TRIANGLES</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>n<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">initVertexBuffers</span><span class="token punctuation">(</span>gl<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> verticesColors <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Float32Array</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
        <span class="token number">0.0</span><span class="token punctuation">,</span><span class="token number">1.0</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">4.0</span><span class="token punctuation">,</span><span class="token number">0.4</span><span class="token punctuation">,</span><span class="token number">1.0</span><span class="token punctuation">,</span><span class="token number">0.4</span><span class="token punctuation">,</span>
        <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">1.0</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">4.0</span><span class="token punctuation">,</span><span class="token number">0.4</span><span class="token punctuation">,</span><span class="token number">1.0</span><span class="token punctuation">,</span><span class="token number">0.4</span><span class="token punctuation">,</span>
        <span class="token number">0.5</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">1.0</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">4.0</span><span class="token punctuation">,</span><span class="token number">1.0</span><span class="token punctuation">,</span><span class="token number">0.4</span><span class="token punctuation">,</span><span class="token number">0.4</span><span class="token punctuation">,</span>

        <span class="token number">0.0</span><span class="token punctuation">,</span><span class="token number">1.0</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">2.0</span><span class="token punctuation">,</span><span class="token number">1.0</span><span class="token punctuation">,</span><span class="token number">1.0</span><span class="token punctuation">,</span><span class="token number">0.4</span><span class="token punctuation">,</span>
        <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">1.0</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">2.0</span><span class="token punctuation">,</span><span class="token number">1.0</span><span class="token punctuation">,</span><span class="token number">1.0</span><span class="token punctuation">,</span><span class="token number">0.4</span><span class="token punctuation">,</span>
        <span class="token number">0.5</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">1.0</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">2.0</span><span class="token punctuation">,</span><span class="token number">1.0</span><span class="token punctuation">,</span><span class="token number">0.4</span><span class="token punctuation">,</span><span class="token number">0.4</span><span class="token punctuation">,</span>

        <span class="token number">0.0</span><span class="token punctuation">,</span><span class="token number">1.0</span><span class="token punctuation">,</span><span class="token number">0.0</span><span class="token punctuation">,</span><span class="token number">0.4</span><span class="token punctuation">,</span><span class="token number">0.4</span><span class="token punctuation">,</span><span class="token number">1.0</span><span class="token punctuation">,</span>
        <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">1.0</span><span class="token punctuation">,</span><span class="token number">0.0</span><span class="token punctuation">,</span><span class="token number">0.4</span><span class="token punctuation">,</span><span class="token number">0.4</span><span class="token punctuation">,</span><span class="token number">1.0</span><span class="token punctuation">,</span>
        <span class="token number">0.5</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">1.0</span><span class="token punctuation">,</span><span class="token number">0.0</span><span class="token punctuation">,</span><span class="token number">1.0</span><span class="token punctuation">,</span><span class="token number">0.4</span><span class="token punctuation">,</span><span class="token number">0.4</span><span class="token punctuation">,</span>

    <span class="token punctuation">]</span><span class="token punctuation">)</span>

    <span class="token keyword">var</span> n <span class="token operator">=</span> <span class="token number">9</span><span class="token punctuation">;</span>
    <span class="token comment">// 创建缓冲区对象</span>
    <span class="token keyword">var</span> vertexColorbuffer <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">createBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    gl<span class="token punctuation">.</span><span class="token function">bindBuffer</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span>vertexColorbuffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
    gl<span class="token punctuation">.</span><span class="token function">bufferData</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span>verticesColors<span class="token punctuation">,</span>gl<span class="token punctuation">.</span><span class="token constant">STATIC_DRAW</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> <span class="token constant">FSIZE</span> <span class="token operator">=</span> verticesColors<span class="token punctuation">.</span><span class="token constant">BYTES_PER_ELEMENT</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> a_Position <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getAttribLocation</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span>program<span class="token punctuation">,</span><span class="token string">'a_Position'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 将缓冲区对象分配给 a_Position变量</span>
    gl<span class="token punctuation">.</span><span class="token function">vertexAttribPointer</span><span class="token punctuation">(</span>a_Position<span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span>gl<span class="token punctuation">.</span><span class="token constant">FLOAT</span><span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token constant">FSIZE</span> <span class="token operator">*</span> <span class="token number">6</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    gl<span class="token punctuation">.</span><span class="token function">enableVertexAttribArray</span><span class="token punctuation">(</span>a_Position<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> a_Color <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getAttribLocation</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span>program<span class="token punctuation">,</span><span class="token string">'a_Color'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    gl<span class="token punctuation">.</span><span class="token function">vertexAttribPointer</span><span class="token punctuation">(</span>a_Color<span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span>gl<span class="token punctuation">.</span><span class="token constant">FLOAT</span><span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token constant">FSIZE</span> <span class="token operator">*</span> <span class="token number">6</span><span class="token punctuation">,</span><span class="token constant">FSIZE</span> <span class="token operator">*</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    gl<span class="token punctuation">.</span><span class="token function">enableVertexAttribArray</span><span class="token punctuation">(</span>a_Color<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> n<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre></div><blockquote><p>也可以在js里面   mvpMatrix.set(projMatrix).multiply(viewMatrix).multiply(modelMatrix);用一个矩阵的相乘 提前就算出模型视图投影矩阵（model view projection matrix） 这样可以优化性能。</p></blockquote> <h2 id="八、正确处理对象的前后关系"><a href="#八、正确处理对象的前后关系" aria-hidden="true" class="header-anchor">#</a> 八、正确处理对象的前后关系</h2> <blockquote><p>webgl 在默认的情况下按照缓冲区中的顺序绘制图形，而且后悔值的图形覆盖先绘制的图形，这是为了提高效率。如果视点不动的话提前定义图形的顺序是没有问题的，但是如果从不同的角度看物体，那就不能这样设定。</p></blockquote> <h3 id="隐藏面消除（hidden-surface-removal）"><a href="#隐藏面消除（hidden-surface-removal）" aria-hidden="true" class="header-anchor">#</a> 隐藏面消除（hidden surface removal）</h3> <blockquote><p>为了解决这个问题，webgl提供了隐藏慢消除的功能。开启这一功能需要两步。</p></blockquote> <ol><li>开始隐藏面消除功能 gl.enable(gl.DEPTH_TEST);</li> <li>在绘制之前清除深度缓冲区 gl.clear(gl.DEPTH_BUFFER_BIT);</li></ol> <p>深度缓冲区的租用是 在片元着色器将图形绘制到颜色缓冲区上之前，如果开启了隐藏面消除，则要进行深度检测（判断每个像素的深度，来决定是否将这个像素画出来）,深度缓冲区用来存储像素的深度信息。
（如果要同时清除深度缓冲区和颜色缓冲区 可以使用 ‘|’ 符号进行连接）</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 顶点着色器</span>
<span class="token keyword">var</span> <span class="token constant">VSHANER_SOURCE</span> <span class="token operator">=</span>
    <span class="token template-string"><span class="token string">`
        attribute vec4 a_Position;
        attribute vec4 a_Color;
        uniform mat4 u_MvpMatrix;
        varying vec4 v_Color;
        void main() {
            gl_Position =u_MvpMatrix * a_Position;
            v_Color = a_Color;
        }
    `</span></span><span class="token punctuation">;</span>
<span class="token comment">// 片元着色器</span>
<span class="token keyword">var</span> <span class="token constant">FSHADER_SOURCE</span> <span class="token operator">=</span>
<span class="token template-string"><span class="token string">`
    precision highp float; // 需要声明浮点数精度否则报错
    varying vec4 v_Color;
    void main() {
        gl_FragColor = v_Color;
    }
`</span></span>
<span class="token keyword">function</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> canvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'webgl'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> gl <span class="token operator">=</span> <span class="token function">getWebGLContext</span><span class="token punctuation">(</span>canvas<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>gl<span class="token punctuation">)</span><span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 初始化着色器</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">initShaders</span><span class="token punctuation">(</span>gl<span class="token punctuation">,</span><span class="token constant">VSHANER_SOURCE</span><span class="token punctuation">,</span><span class="token constant">FSHADER_SOURCE</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">var</span> n <span class="token operator">=</span> <span class="token function">initVertexBuffers</span><span class="token punctuation">(</span>gl<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>n<span class="token operator">&lt;</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;error&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">var</span> u_MvpMatrix <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getUniformLocation</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span>program<span class="token punctuation">,</span><span class="token string">'u_MvpMatrix'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 模型矩阵</span>
    <span class="token keyword">var</span> modelMatrix <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Matrix4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 设置视点 视线 和上方向</span>
    <span class="token keyword">var</span> viewMatrix <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Matrix4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 投影矩阵</span>
    <span class="token keyword">var</span> projMatrix <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Matrix4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 混合投影</span>
    <span class="token keyword">var</span> mvpMatrix <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Matrix4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


    <span class="token comment">// 计算视图矩阵和投影矩阵</span>
    modelMatrix<span class="token punctuation">.</span><span class="token function">setTranslate</span><span class="token punctuation">(</span><span class="token number">0.75</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 平移0.75单位</span>
    viewMatrix<span class="token punctuation">.</span><span class="token function">setLookAt</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">200</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    projMatrix<span class="token punctuation">.</span><span class="token function">setPerspective</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">,</span>canvas<span class="token punctuation">.</span>width<span class="token operator">/</span>canvas<span class="token punctuation">.</span>height<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    mvpMatrix<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span>projMatrix<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">multiply</span><span class="token punctuation">(</span>viewMatrix<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">multiply</span><span class="token punctuation">(</span>modelMatrix<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 将试图矩阵和投影矩阵传递给参数</span>
    gl<span class="token punctuation">.</span><span class="token function">uniformMatrix4fv</span><span class="token punctuation">(</span>u_MvpMatrix<span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">,</span>mvpMatrix<span class="token punctuation">.</span>elements<span class="token punctuation">)</span><span class="token punctuation">;</span>

    gl<span class="token punctuation">.</span><span class="token function">clearColor</span><span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span><span class="token number">0.0</span><span class="token punctuation">,</span><span class="token number">0.0</span><span class="token punctuation">,</span><span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 开启隐藏面消除(注释掉这句话试试？？？)</span>
    gl<span class="token punctuation">.</span><span class="token function">enable</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">DEPTH_TEST</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    gl<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">COLOR_BUFFER_BIT</span> <span class="token operator">|</span> gl<span class="token punctuation">.</span><span class="token constant">DEPTH_BUFFER_BIT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    gl<span class="token punctuation">.</span><span class="token function">drawArrays</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TRIANGLES</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>n<span class="token punctuation">)</span><span class="token punctuation">;</span>

    modelMatrix<span class="token punctuation">.</span><span class="token function">setTranslate</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">0.75</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    mvpMatrix<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span>projMatrix<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">multiply</span><span class="token punctuation">(</span>viewMatrix<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">multiply</span><span class="token punctuation">(</span>modelMatrix<span class="token punctuation">)</span><span class="token punctuation">;</span>
    gl<span class="token punctuation">.</span><span class="token function">uniformMatrix4fv</span><span class="token punctuation">(</span>u_MvpMatrix<span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">,</span>mvpMatrix<span class="token punctuation">.</span>elements<span class="token punctuation">)</span><span class="token punctuation">;</span>
    gl<span class="token punctuation">.</span><span class="token function">drawArrays</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TRIANGLES</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>n<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">initVertexBuffers</span><span class="token punctuation">(</span>gl<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> verticesColors <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Float32Array</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
        <span class="token number">0.0</span><span class="token punctuation">,</span><span class="token number">1.0</span><span class="token punctuation">,</span><span class="token number">0.0</span><span class="token punctuation">,</span><span class="token number">0.4</span><span class="token punctuation">,</span><span class="token number">1.0</span><span class="token punctuation">,</span><span class="token number">0.4</span><span class="token punctuation">,</span>
        <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">1.0</span><span class="token punctuation">,</span><span class="token number">0.0</span><span class="token punctuation">,</span><span class="token number">0.4</span><span class="token punctuation">,</span><span class="token number">1.0</span><span class="token punctuation">,</span><span class="token number">0.4</span><span class="token punctuation">,</span>
        <span class="token number">0.5</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">1.0</span><span class="token punctuation">,</span><span class="token number">0.0</span><span class="token punctuation">,</span><span class="token number">1.0</span><span class="token punctuation">,</span><span class="token number">0.4</span><span class="token punctuation">,</span><span class="token number">0.4</span><span class="token punctuation">,</span>

        <span class="token number">0.0</span><span class="token punctuation">,</span><span class="token number">1.0</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">2.0</span><span class="token punctuation">,</span><span class="token number">1.0</span><span class="token punctuation">,</span><span class="token number">1.0</span><span class="token punctuation">,</span><span class="token number">0.4</span><span class="token punctuation">,</span>
        <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">1.0</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">2.0</span><span class="token punctuation">,</span><span class="token number">1.0</span><span class="token punctuation">,</span><span class="token number">1.0</span><span class="token punctuation">,</span><span class="token number">0.4</span><span class="token punctuation">,</span>
        <span class="token number">0.5</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">1.0</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">2.0</span><span class="token punctuation">,</span><span class="token number">1.0</span><span class="token punctuation">,</span><span class="token number">0.4</span><span class="token punctuation">,</span><span class="token number">0.4</span><span class="token punctuation">,</span>

        <span class="token number">0.0</span><span class="token punctuation">,</span><span class="token number">1.0</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">4.0</span><span class="token punctuation">,</span><span class="token number">0.4</span><span class="token punctuation">,</span><span class="token number">0.4</span><span class="token punctuation">,</span><span class="token number">1.0</span><span class="token punctuation">,</span>
        <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">1.0</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">4.0</span><span class="token punctuation">,</span><span class="token number">0.4</span><span class="token punctuation">,</span><span class="token number">0.4</span><span class="token punctuation">,</span><span class="token number">1.0</span><span class="token punctuation">,</span>
        <span class="token number">0.5</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">1.0</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">4.0</span><span class="token punctuation">,</span><span class="token number">1.0</span><span class="token punctuation">,</span><span class="token number">0.4</span><span class="token punctuation">,</span><span class="token number">0.4</span><span class="token punctuation">,</span>

    <span class="token punctuation">]</span><span class="token punctuation">)</span>

    <span class="token keyword">var</span> n <span class="token operator">=</span> <span class="token number">9</span><span class="token punctuation">;</span>
    <span class="token comment">// 创建缓冲区对象</span>
    <span class="token keyword">var</span> vertexColorbuffer <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">createBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    gl<span class="token punctuation">.</span><span class="token function">bindBuffer</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span>vertexColorbuffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
    gl<span class="token punctuation">.</span><span class="token function">bufferData</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span>verticesColors<span class="token punctuation">,</span>gl<span class="token punctuation">.</span><span class="token constant">STATIC_DRAW</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> <span class="token constant">FSIZE</span> <span class="token operator">=</span> verticesColors<span class="token punctuation">.</span><span class="token constant">BYTES_PER_ELEMENT</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> a_Position <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getAttribLocation</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span>program<span class="token punctuation">,</span><span class="token string">'a_Position'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 将缓冲区对象分配给 a_Position变量</span>
    gl<span class="token punctuation">.</span><span class="token function">vertexAttribPointer</span><span class="token punctuation">(</span>a_Position<span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span>gl<span class="token punctuation">.</span><span class="token constant">FLOAT</span><span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token constant">FSIZE</span> <span class="token operator">*</span> <span class="token number">6</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    gl<span class="token punctuation">.</span><span class="token function">enableVertexAttribArray</span><span class="token punctuation">(</span>a_Position<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> a_Color <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getAttribLocation</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span>program<span class="token punctuation">,</span><span class="token string">'a_Color'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    gl<span class="token punctuation">.</span><span class="token function">vertexAttribPointer</span><span class="token punctuation">(</span>a_Color<span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span>gl<span class="token punctuation">.</span><span class="token constant">FLOAT</span><span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token constant">FSIZE</span> <span class="token operator">*</span> <span class="token number">6</span><span class="token punctuation">,</span><span class="token constant">FSIZE</span> <span class="token operator">*</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    gl<span class="token punctuation">.</span><span class="token function">enableVertexAttribArray</span><span class="token punctuation">(</span>a_Color<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> n<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="深度冲突"><a href="#深度冲突" aria-hidden="true" class="header-anchor">#</a> 深度冲突</h3> <blockquote><p>当几何图形或者物体的两个表面极为接近时就会出现新的问题，表面看上去斑驳不堪，这种现行成为深度冲突（修改上面代码三角形的Z轴的值改成一样的 可以看到类似效果）。</p></blockquote> <ul><li>webgl提供一种被成为多边形偏移（polygon offset）的机制来解决这个问题。该机制自动的在Z职上加一个偏移量，偏移量的值由物体表面相对于观察者实现的角度来确定。实现这一机制需要两步：</li></ul> <ol><li>启用多边形偏移 gl.enable(gl.POLYGON_OFFSET_FILL);</li> <li>在绘制执勤啊指定用来计算偏移量的参数 gl.polygonOffset(1.0,1.0);</li></ol> <blockquote><p>有些浏览器会自动处理深度冲突问题</p></blockquote> <h2 id="九、-立方体"><a href="#九、-立方体" aria-hidden="true" class="header-anchor">#</a> 九、 立方体</h2> <p>之前我们都是通过绘制简单的三角形展示Webgl的诸多特性，下面我们来真正的进入立方体的绘制。之前我们使用gl.drawArrays()方法进行绘制，如果使用这个方法我们需要绘制两个三小型成为一个矩形表面，然后绘制出所有的面组成立方体。这种方法需要12个三角形 也就是36个顶点。但是实际上一个正方体只需要8个顶点。所以这种方法显然是低效的。webgl提供了一个新的函数 gl.drawElements()，来避免重复的定氮仪顶点，保持顶点数量最小。
<img src="https://upload-images.jianshu.io/upload_images/10319049-77e5c5227c1a6640.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="微信图片_20190507100107.png"></p> <p>我们要将三角形列表传入到gl.ELEMENT_ARRAY_BUFFER中，它管理者具有素银结构的三维模型数据。
下图是正方体的索引结构的三维模型数据。</p> <p><img src="https://upload-images.jianshu.io/upload_images/10319049-d6c42f814f3148bc.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="微信图片_20190507100625.png"></p> <div class="language-js extra-class"><pre class="language-js"><code>  <span class="token comment">// 第一个立方体</span>
  <span class="token comment">// 顶点着色器</span>
<span class="token keyword">var</span> <span class="token constant">VSHANER_SOURCE</span> <span class="token operator">=</span>
    <span class="token template-string"><span class="token string">`
        attribute vec4 a_Position;
        attribute vec4 a_Color;
        uniform mat4 u_MvpMatrix;
        varying vec4 v_Color;
        void main() {
            gl_Position =u_MvpMatrix * a_Position;
            v_Color = a_Color;
        }
    `</span></span><span class="token punctuation">;</span>
<span class="token comment">// 片元着色器</span>
<span class="token keyword">var</span> <span class="token constant">FSHADER_SOURCE</span> <span class="token operator">=</span>
<span class="token template-string"><span class="token string">`
    precision highp float; // 需要声明浮点数精度否则报错
    varying vec4 v_Color;
    void main() {
        gl_FragColor = v_Color;
    }
`</span></span>
<span class="token keyword">function</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> canvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'webgl'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> gl <span class="token operator">=</span> <span class="token function">getWebGLContext</span><span class="token punctuation">(</span>canvas<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>gl<span class="token punctuation">)</span><span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 初始化着色器</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">initShaders</span><span class="token punctuation">(</span>gl<span class="token punctuation">,</span><span class="token constant">VSHANER_SOURCE</span><span class="token punctuation">,</span><span class="token constant">FSHADER_SOURCE</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">var</span> n <span class="token operator">=</span> <span class="token function">initVertexBuffers</span><span class="token punctuation">(</span>gl<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>n<span class="token operator">&lt;</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;error&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    gl<span class="token punctuation">.</span><span class="token function">clearColor</span><span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span><span class="token number">0.0</span><span class="token punctuation">,</span><span class="token number">0.0</span><span class="token punctuation">,</span><span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 开启隐藏面消除</span>
    gl<span class="token punctuation">.</span><span class="token function">enable</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">DEPTH_TEST</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">var</span> u_MvpMatrix <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getUniformLocation</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span>program<span class="token punctuation">,</span><span class="token string">'u_MvpMatrix'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 混合投影</span>
    <span class="token keyword">var</span> mvpMatrix <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Matrix4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 设置视点 视线 和上方向</span>
    <span class="token keyword">var</span> viewMatrix <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Matrix4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 投影矩阵</span>
    <span class="token keyword">var</span> projMatrix <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Matrix4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    viewMatrix<span class="token punctuation">.</span><span class="token function">setLookAt</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    projMatrix<span class="token punctuation">.</span><span class="token function">setPerspective</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">,</span>canvas<span class="token punctuation">.</span>width<span class="token operator">/</span>canvas<span class="token punctuation">.</span>height<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    mvpMatrix<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span>projMatrix<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">multiply</span><span class="token punctuation">(</span>viewMatrix<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 将试图矩阵和投影矩阵传递给参数</span>
    gl<span class="token punctuation">.</span><span class="token function">uniformMatrix4fv</span><span class="token punctuation">(</span>u_MvpMatrix<span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">,</span>mvpMatrix<span class="token punctuation">.</span>elements<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 开启偏移</span>
    gl<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">COLOR_BUFFER_BIT</span> <span class="token operator">|</span> gl<span class="token punctuation">.</span><span class="token constant">DEPTH_BUFFER_BIT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    gl<span class="token punctuation">.</span><span class="token function">drawElements</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TRIANGLES</span><span class="token punctuation">,</span>n<span class="token punctuation">,</span>gl<span class="token punctuation">.</span><span class="token constant">UNSIGNED_BYTE</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">initVertexBuffers</span><span class="token punctuation">(</span>gl<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> verticesColors <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Float32Array</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
        <span class="token comment">// 立方体的顶点坐标和颜色</span>
        <span class="token number">1.0</span><span class="token punctuation">,</span><span class="token number">1.0</span><span class="token punctuation">,</span><span class="token number">1.0</span><span class="token punctuation">,</span><span class="token number">1.0</span><span class="token punctuation">,</span><span class="token number">1.0</span><span class="token punctuation">,</span><span class="token number">1.0</span><span class="token punctuation">,</span>
        <span class="token operator">-</span><span class="token number">1.0</span><span class="token punctuation">,</span><span class="token number">1.0</span><span class="token punctuation">,</span><span class="token number">1.0</span><span class="token punctuation">,</span><span class="token number">1.0</span><span class="token punctuation">,</span><span class="token number">0.0</span><span class="token punctuation">,</span><span class="token number">1.0</span><span class="token punctuation">,</span>
        <span class="token operator">-</span><span class="token number">1.0</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">1.0</span><span class="token punctuation">,</span><span class="token number">1.0</span><span class="token punctuation">,</span><span class="token number">1.0</span><span class="token punctuation">,</span><span class="token number">0.0</span><span class="token punctuation">,</span><span class="token number">0.0</span><span class="token punctuation">,</span>
        <span class="token number">1.0</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">1.0</span><span class="token punctuation">,</span><span class="token number">1.0</span><span class="token punctuation">,</span><span class="token number">1.0</span><span class="token punctuation">,</span><span class="token number">1.0</span><span class="token punctuation">,</span><span class="token number">0.0</span><span class="token punctuation">,</span>
        <span class="token number">1.0</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">1.0</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">1.0</span><span class="token punctuation">,</span><span class="token number">0.0</span><span class="token punctuation">,</span><span class="token number">1.0</span><span class="token punctuation">,</span><span class="token number">0.0</span><span class="token punctuation">,</span>
        <span class="token number">1.0</span><span class="token punctuation">,</span><span class="token number">1.0</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">1.0</span><span class="token punctuation">,</span><span class="token number">0.0</span><span class="token punctuation">,</span><span class="token number">1.0</span><span class="token punctuation">,</span><span class="token number">1.0</span><span class="token punctuation">,</span>
        <span class="token operator">-</span><span class="token number">1.0</span><span class="token punctuation">,</span><span class="token number">1.0</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">1.0</span><span class="token punctuation">,</span><span class="token number">0.0</span><span class="token punctuation">,</span><span class="token number">0.0</span><span class="token punctuation">,</span><span class="token number">1.0</span><span class="token punctuation">,</span>
        <span class="token operator">-</span><span class="token number">1.0</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">1.0</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">1.0</span><span class="token punctuation">,</span><span class="token number">0.0</span><span class="token punctuation">,</span><span class="token number">0.0</span><span class="token punctuation">,</span><span class="token number">0.0</span>
    <span class="token punctuation">]</span><span class="token punctuation">)</span>

    <span class="token comment">// 顶点索引</span>
    <span class="token keyword">var</span> indices <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Uint8Array</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
        <span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token comment">// 前</span>
        <span class="token number">0</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token comment">// 右</span>
        <span class="token number">0</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token comment">// 上</span>
        <span class="token number">1</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token comment">// 左</span>
        <span class="token number">7</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token comment">// 下</span>
        <span class="token number">4</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">5</span>  <span class="token comment">// 后</span>
    <span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token comment">// 创建缓冲区对象</span>
    <span class="token keyword">var</span> vertexColorbuffer <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">createBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    gl<span class="token punctuation">.</span><span class="token function">bindBuffer</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span>vertexColorbuffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
    gl<span class="token punctuation">.</span><span class="token function">bufferData</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span>verticesColors<span class="token punctuation">,</span>gl<span class="token punctuation">.</span><span class="token constant">STATIC_DRAW</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> <span class="token constant">FSIZE</span> <span class="token operator">=</span> verticesColors<span class="token punctuation">.</span><span class="token constant">BYTES_PER_ELEMENT</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> a_Position <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getAttribLocation</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span>program<span class="token punctuation">,</span><span class="token string">'a_Position'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 将缓冲区对象分配给 a_Position变量</span>
    gl<span class="token punctuation">.</span><span class="token function">vertexAttribPointer</span><span class="token punctuation">(</span>a_Position<span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span>gl<span class="token punctuation">.</span><span class="token constant">FLOAT</span><span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token constant">FSIZE</span> <span class="token operator">*</span> <span class="token number">6</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    gl<span class="token punctuation">.</span><span class="token function">enableVertexAttribArray</span><span class="token punctuation">(</span>a_Position<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> a_Color <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getAttribLocation</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span>program<span class="token punctuation">,</span><span class="token string">'a_Color'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    gl<span class="token punctuation">.</span><span class="token function">vertexAttribPointer</span><span class="token punctuation">(</span>a_Color<span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span>gl<span class="token punctuation">.</span><span class="token constant">FLOAT</span><span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token constant">FSIZE</span> <span class="token operator">*</span> <span class="token number">6</span><span class="token punctuation">,</span><span class="token constant">FSIZE</span> <span class="token operator">*</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    gl<span class="token punctuation">.</span><span class="token function">enableVertexAttribArray</span><span class="token punctuation">(</span>a_Color<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 主要区别点</span>
     <span class="token keyword">var</span> indexBuffer <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">createBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    gl<span class="token punctuation">.</span><span class="token function">bindBuffer</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ELEMENT_ARRAY_BUFFER</span><span class="token punctuation">,</span>indexBuffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
    gl<span class="token punctuation">.</span><span class="token function">bufferData</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ELEMENT_ARRAY_BUFFER</span><span class="token punctuation">,</span>indices<span class="token punctuation">,</span>gl<span class="token punctuation">.</span><span class="token constant">STATIC_DRAW</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> indices<span class="token punctuation">.</span>length<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>这个方法通过循环利用顶点信息，控制内存的开销，但是代价是你需要通过索引来简介的访问顶点，使得程序复杂化了。下图展示了使用索引缓冲区后webgl的内部状态。
<img src="https://upload-images.jianshu.io/upload_images/10319049-f88f08f853c29d14.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="微信图片_20190507105120.png"></p> <h2 id="十、为每个面指定颜色"><a href="#十、为每个面指定颜色" aria-hidden="true" class="header-anchor">#</a> 十、为每个面指定颜色</h2> <blockquote><p>我们知道 如果想指定颜色，必须要将颜色定义为逐顶点信息，并传入到顶点着色器中，也就是说你想让一个面为蓝色，那这个面的四个顶点都必须为蓝色。但是我们的顶点是公用的，如果改变一个面的四个顶点为蓝色，那其他面也会染上蓝色。这不是我们想要。那如何解决呢</p></blockquote> <ul><li>解决方法：创建多个具有相同顶点坐标的顶点，其实就是允余的定义顶点。如下图
<img src="https://upload-images.jianshu.io/upload_images/10319049-87825b93ded496f0.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="微信图片_20190507105826.png"></li></ul> <div class="language-js extra-class"><pre class="language-js"><code>    <span class="token comment">// 顶点着色器</span>
<span class="token keyword">var</span> <span class="token constant">VSHANER_SOURCE</span> <span class="token operator">=</span>
    <span class="token template-string"><span class="token string">`
        attribute vec4 a_Position;
        attribute vec4 a_Color;
        uniform mat4 u_MvpMatrix;
        varying vec4 v_Color;
        void main() {
            gl_Position =u_MvpMatrix * a_Position;
            v_Color = a_Color;
        }
    `</span></span><span class="token punctuation">;</span>
<span class="token comment">// 片元着色器</span>
<span class="token keyword">var</span> <span class="token constant">FSHADER_SOURCE</span> <span class="token operator">=</span>
<span class="token template-string"><span class="token string">`
    precision highp float; // 需要声明浮点数精度否则报错
    varying vec4 v_Color;
    void main() {
        gl_FragColor = v_Color;
    }
`</span></span>
<span class="token keyword">function</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> canvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'webgl'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> gl <span class="token operator">=</span> <span class="token function">getWebGLContext</span><span class="token punctuation">(</span>canvas<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>gl<span class="token punctuation">)</span><span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 初始化着色器</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">initShaders</span><span class="token punctuation">(</span>gl<span class="token punctuation">,</span><span class="token constant">VSHANER_SOURCE</span><span class="token punctuation">,</span><span class="token constant">FSHADER_SOURCE</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">var</span> n <span class="token operator">=</span> <span class="token function">initVertexBuffers</span><span class="token punctuation">(</span>gl<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>n<span class="token operator">&lt;</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;error&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    gl<span class="token punctuation">.</span><span class="token function">clearColor</span><span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span><span class="token number">0.0</span><span class="token punctuation">,</span><span class="token number">0.0</span><span class="token punctuation">,</span><span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 开启隐藏面消除</span>
    gl<span class="token punctuation">.</span><span class="token function">enable</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">DEPTH_TEST</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">var</span> u_MvpMatrix <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getUniformLocation</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span>program<span class="token punctuation">,</span><span class="token string">'u_MvpMatrix'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 混合投影</span>
    <span class="token keyword">var</span> mvpMatrix <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Matrix4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 设置视点 视线 和上方向</span>
    <span class="token keyword">var</span> viewMatrix <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Matrix4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 投影矩阵</span>
    <span class="token keyword">var</span> projMatrix <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Matrix4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    viewMatrix<span class="token punctuation">.</span><span class="token function">setLookAt</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    projMatrix<span class="token punctuation">.</span><span class="token function">setPerspective</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">,</span>canvas<span class="token punctuation">.</span>width<span class="token operator">/</span>canvas<span class="token punctuation">.</span>height<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    mvpMatrix<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span>projMatrix<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">multiply</span><span class="token punctuation">(</span>viewMatrix<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 将试图矩阵和投影矩阵传递给参数</span>
    gl<span class="token punctuation">.</span><span class="token function">uniformMatrix4fv</span><span class="token punctuation">(</span>u_MvpMatrix<span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">,</span>mvpMatrix<span class="token punctuation">.</span>elements<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 开启偏移</span>
    gl<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">COLOR_BUFFER_BIT</span> <span class="token operator">|</span> gl<span class="token punctuation">.</span><span class="token constant">DEPTH_BUFFER_BIT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    gl<span class="token punctuation">.</span><span class="token function">drawElements</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TRIANGLES</span><span class="token punctuation">,</span>n<span class="token punctuation">,</span>gl<span class="token punctuation">.</span><span class="token constant">UNSIGNED_BYTE</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">initVertexBuffers</span><span class="token punctuation">(</span>gl<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> v0  <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1.0</span><span class="token punctuation">,</span><span class="token number">1.0</span><span class="token punctuation">,</span><span class="token number">1.0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> v1  <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1.0</span><span class="token punctuation">,</span><span class="token number">1.0</span><span class="token punctuation">,</span><span class="token number">1.0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> v2  <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1.0</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">1.0</span><span class="token punctuation">,</span><span class="token number">1.0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> v3  <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1.0</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">1.0</span><span class="token punctuation">,</span><span class="token number">1.0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> v4  <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1.0</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">1.0</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">1.0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> v5  <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1.0</span><span class="token punctuation">,</span><span class="token number">1.0</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">1.0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> v6  <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1.0</span><span class="token punctuation">,</span><span class="token number">1.0</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">1.0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> v7  <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1.0</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">1.0</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">1.0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token comment">// 这个坐标为什么是这样 对照上图慢慢理解一下</span>
    <span class="token keyword">var</span> vertices <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Float32Array</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
        <span class="token comment">// 立方体的顶点坐标和颜色</span>
        <span class="token operator">...</span>v0<span class="token punctuation">,</span><span class="token operator">...</span>v1<span class="token punctuation">,</span><span class="token operator">...</span>v2<span class="token punctuation">,</span><span class="token operator">...</span>v3<span class="token punctuation">,</span>
        <span class="token operator">...</span>v0<span class="token punctuation">,</span><span class="token operator">...</span>v3<span class="token punctuation">,</span><span class="token operator">...</span>v4<span class="token punctuation">,</span><span class="token operator">...</span>v5<span class="token punctuation">,</span>
        <span class="token operator">...</span>v0<span class="token punctuation">,</span><span class="token operator">...</span>v5<span class="token punctuation">,</span><span class="token operator">...</span>v6<span class="token punctuation">,</span><span class="token operator">...</span>v1<span class="token punctuation">,</span>
        <span class="token operator">...</span>v1<span class="token punctuation">,</span><span class="token operator">...</span>v6<span class="token punctuation">,</span><span class="token operator">...</span>v7<span class="token punctuation">,</span><span class="token operator">...</span>v2<span class="token punctuation">,</span>
        <span class="token operator">...</span>v2<span class="token punctuation">,</span><span class="token operator">...</span>v3<span class="token punctuation">,</span><span class="token operator">...</span>v4<span class="token punctuation">,</span><span class="token operator">...</span>v7<span class="token punctuation">,</span>
        <span class="token operator">...</span>v4<span class="token punctuation">,</span><span class="token operator">...</span>v7<span class="token punctuation">,</span><span class="token operator">...</span>v6<span class="token punctuation">,</span><span class="token operator">...</span>v5
    <span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token comment">// 顶点索引</span>
    <span class="token keyword">var</span> indices <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Uint8Array</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
        <span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token comment">// 前</span>
        <span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">,</span> <span class="token comment">// 右</span>
        <span class="token number">8</span><span class="token punctuation">,</span><span class="token number">9</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">11</span><span class="token punctuation">,</span> <span class="token comment">// 上</span>
        <span class="token number">12</span><span class="token punctuation">,</span><span class="token number">13</span><span class="token punctuation">,</span><span class="token number">14</span><span class="token punctuation">,</span><span class="token number">12</span><span class="token punctuation">,</span><span class="token number">14</span><span class="token punctuation">,</span><span class="token number">15</span><span class="token punctuation">,</span> <span class="token comment">// 左</span>
        <span class="token number">16</span><span class="token punctuation">,</span><span class="token number">17</span><span class="token punctuation">,</span><span class="token number">18</span><span class="token punctuation">,</span><span class="token number">16</span><span class="token punctuation">,</span><span class="token number">18</span><span class="token punctuation">,</span><span class="token number">19</span><span class="token punctuation">,</span> <span class="token comment">// 下</span>
        <span class="token number">20</span><span class="token punctuation">,</span><span class="token number">21</span><span class="token punctuation">,</span><span class="token number">22</span><span class="token punctuation">,</span><span class="token number">20</span><span class="token punctuation">,</span><span class="token number">22</span><span class="token punctuation">,</span><span class="token number">23</span> <span class="token comment">// 后</span>
    <span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">var</span> color <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Float32Array</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
        <span class="token number">0.4</span><span class="token punctuation">,</span><span class="token number">0.4</span><span class="token punctuation">,</span><span class="token number">1.0</span><span class="token punctuation">,</span><span class="token number">0.4</span><span class="token punctuation">,</span><span class="token number">0.4</span><span class="token punctuation">,</span><span class="token number">1.0</span><span class="token punctuation">,</span><span class="token number">0.4</span><span class="token punctuation">,</span><span class="token number">0.4</span><span class="token punctuation">,</span><span class="token number">1.0</span><span class="token punctuation">,</span><span class="token number">0.4</span><span class="token punctuation">,</span><span class="token number">0.4</span><span class="token punctuation">,</span><span class="token number">1.0</span><span class="token punctuation">,</span>
        <span class="token number">0.4</span><span class="token punctuation">,</span><span class="token number">1.0</span><span class="token punctuation">,</span><span class="token number">0.4</span><span class="token punctuation">,</span><span class="token number">0.4</span><span class="token punctuation">,</span><span class="token number">1.0</span><span class="token punctuation">,</span><span class="token number">0.4</span><span class="token punctuation">,</span><span class="token number">0.4</span><span class="token punctuation">,</span><span class="token number">1.0</span><span class="token punctuation">,</span><span class="token number">0.4</span><span class="token punctuation">,</span><span class="token number">0.4</span><span class="token punctuation">,</span><span class="token number">1.0</span><span class="token punctuation">,</span><span class="token number">0.4</span><span class="token punctuation">,</span>
        <span class="token number">1.0</span><span class="token punctuation">,</span><span class="token number">0.4</span><span class="token punctuation">,</span><span class="token number">0.4</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span><span class="token number">0.4</span><span class="token punctuation">,</span><span class="token number">0.4</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span><span class="token number">0.4</span><span class="token punctuation">,</span><span class="token number">0.4</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span><span class="token number">0.4</span><span class="token punctuation">,</span><span class="token number">0.4</span><span class="token punctuation">,</span>
        <span class="token number">0.4</span><span class="token punctuation">,</span><span class="token number">0.4</span><span class="token punctuation">,</span><span class="token number">0.4</span><span class="token punctuation">,</span><span class="token number">0.4</span><span class="token punctuation">,</span><span class="token number">0.4</span><span class="token punctuation">,</span><span class="token number">0.4</span><span class="token punctuation">,</span><span class="token number">0.4</span><span class="token punctuation">,</span><span class="token number">0.4</span><span class="token punctuation">,</span><span class="token number">0.4</span><span class="token punctuation">,</span><span class="token number">0.4</span><span class="token punctuation">,</span><span class="token number">0.4</span><span class="token punctuation">,</span><span class="token number">0.4</span><span class="token punctuation">,</span>
        <span class="token number">1.0</span><span class="token punctuation">,</span><span class="token number">1.0</span><span class="token punctuation">,</span><span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span><span class="token number">1.0</span><span class="token punctuation">,</span><span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span><span class="token number">1.0</span><span class="token punctuation">,</span><span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span><span class="token number">1.0</span><span class="token punctuation">,</span><span class="token number">1.0</span><span class="token punctuation">,</span>
        <span class="token number">0.4</span><span class="token punctuation">,</span><span class="token number">1.0</span><span class="token punctuation">,</span><span class="token number">1.0</span><span class="token punctuation">,</span><span class="token number">0.4</span><span class="token punctuation">,</span><span class="token number">1.0</span><span class="token punctuation">,</span><span class="token number">1.0</span><span class="token punctuation">,</span><span class="token number">0.4</span><span class="token punctuation">,</span><span class="token number">1.0</span><span class="token punctuation">,</span><span class="token number">1.0</span><span class="token punctuation">,</span><span class="token number">0.4</span><span class="token punctuation">,</span><span class="token number">1.0</span><span class="token punctuation">,</span><span class="token number">1.0</span>
    <span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token comment">// 创建缓冲区对象</span>
    <span class="token keyword">var</span> indexBuffer <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">createBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">initArrayBuffer</span><span class="token punctuation">(</span>gl<span class="token punctuation">,</span>vertices<span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span>gl<span class="token punctuation">.</span><span class="token constant">FLOAT</span><span class="token punctuation">,</span><span class="token string">'a_Position'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">initArrayBuffer</span><span class="token punctuation">(</span>gl<span class="token punctuation">,</span>color<span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span>gl<span class="token punctuation">.</span><span class="token constant">FLOAT</span><span class="token punctuation">,</span><span class="token string">'a_Color'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    gl<span class="token punctuation">.</span><span class="token function">bindBuffer</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ELEMENT_ARRAY_BUFFER</span><span class="token punctuation">,</span>indexBuffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
    gl<span class="token punctuation">.</span><span class="token function">bufferData</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ELEMENT_ARRAY_BUFFER</span><span class="token punctuation">,</span>indices<span class="token punctuation">,</span>gl<span class="token punctuation">.</span><span class="token constant">STATIC_DRAW</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> indices<span class="token punctuation">.</span>length<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">initArrayBuffer</span><span class="token punctuation">(</span>gl<span class="token punctuation">,</span>data<span class="token punctuation">,</span>num<span class="token punctuation">,</span>type<span class="token punctuation">,</span>attribute<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 创建缓冲区对象</span>
    <span class="token keyword">var</span> buffer <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">createBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    gl<span class="token punctuation">.</span><span class="token function">bindBuffer</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
    gl<span class="token punctuation">.</span><span class="token function">bufferData</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span>data<span class="token punctuation">,</span>gl<span class="token punctuation">.</span><span class="token constant">STATIC_DRAW</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> a_attribute <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getAttribLocation</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span>program<span class="token punctuation">,</span>attribute<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 将缓冲区对象分配给 a_Position变量</span>
    gl<span class="token punctuation">.</span><span class="token function">vertexAttribPointer</span><span class="token punctuation">(</span>a_attribute<span class="token punctuation">,</span>num<span class="token punctuation">,</span>type<span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    gl<span class="token punctuation">.</span><span class="token function">enableVertexAttribArray</span><span class="token punctuation">(</span>a_attribute<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>如果将所有的颜色改成白色会是神马效果呢？ 自己试一下。
看不出是什么东西了，因为颜色没有差异后变得界限也就没有了，但是我们在现实生活中一个白色的盒子还是可以看出是一个正方体，那是因为有光照产生了颜色的细微差异。
下一章 我们学习如果运用三维场景中的光照。</p></div> <div class="page-edit"><!----> <!----></div> <!----> </div> <!----></div></div>
    <script src="/fengyestudybase/assets/js/app.0a47e211.js" defer></script><script src="/fengyestudybase/assets/js/20.a5bcc6c6.js" defer></script>
  </body>
</html>
