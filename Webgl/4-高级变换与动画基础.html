<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>4-高级变换和动画基础 | 七色枫叶的学习基地</title>
    <meta name="description" content="不积跬步无以至千里，不积小流无以成江河">
    
    
    <link rel="preload" href="/fengyestudybase/assets/css/0.styles.5e309cc9.css" as="style"><link rel="preload" href="/fengyestudybase/assets/js/app.0a47e211.js" as="script"><link rel="preload" href="/fengyestudybase/assets/js/17.0faefb8a.js" as="script"><link rel="prefetch" href="/fengyestudybase/assets/js/10.30c47e52.js"><link rel="prefetch" href="/fengyestudybase/assets/js/11.4acf0b7f.js"><link rel="prefetch" href="/fengyestudybase/assets/js/12.01897755.js"><link rel="prefetch" href="/fengyestudybase/assets/js/13.927942cf.js"><link rel="prefetch" href="/fengyestudybase/assets/js/14.95996584.js"><link rel="prefetch" href="/fengyestudybase/assets/js/15.2a6554aa.js"><link rel="prefetch" href="/fengyestudybase/assets/js/16.2eacfb27.js"><link rel="prefetch" href="/fengyestudybase/assets/js/18.dec666b8.js"><link rel="prefetch" href="/fengyestudybase/assets/js/19.61499d52.js"><link rel="prefetch" href="/fengyestudybase/assets/js/2.864db199.js"><link rel="prefetch" href="/fengyestudybase/assets/js/20.a5bcc6c6.js"><link rel="prefetch" href="/fengyestudybase/assets/js/21.48500825.js"><link rel="prefetch" href="/fengyestudybase/assets/js/22.09012641.js"><link rel="prefetch" href="/fengyestudybase/assets/js/23.c64fdaef.js"><link rel="prefetch" href="/fengyestudybase/assets/js/24.fb975750.js"><link rel="prefetch" href="/fengyestudybase/assets/js/25.84edc7a1.js"><link rel="prefetch" href="/fengyestudybase/assets/js/26.48396beb.js"><link rel="prefetch" href="/fengyestudybase/assets/js/27.496aa837.js"><link rel="prefetch" href="/fengyestudybase/assets/js/28.3cd6297d.js"><link rel="prefetch" href="/fengyestudybase/assets/js/29.98c70977.js"><link rel="prefetch" href="/fengyestudybase/assets/js/3.ae847aa1.js"><link rel="prefetch" href="/fengyestudybase/assets/js/30.92c849a4.js"><link rel="prefetch" href="/fengyestudybase/assets/js/31.6bc95938.js"><link rel="prefetch" href="/fengyestudybase/assets/js/32.d7c431d6.js"><link rel="prefetch" href="/fengyestudybase/assets/js/33.aa073227.js"><link rel="prefetch" href="/fengyestudybase/assets/js/34.fe2e3207.js"><link rel="prefetch" href="/fengyestudybase/assets/js/35.b8405c57.js"><link rel="prefetch" href="/fengyestudybase/assets/js/36.c29f2ab2.js"><link rel="prefetch" href="/fengyestudybase/assets/js/37.9daf48c3.js"><link rel="prefetch" href="/fengyestudybase/assets/js/38.882175dc.js"><link rel="prefetch" href="/fengyestudybase/assets/js/39.bc5c4f62.js"><link rel="prefetch" href="/fengyestudybase/assets/js/4.5053f111.js"><link rel="prefetch" href="/fengyestudybase/assets/js/40.c93261a7.js"><link rel="prefetch" href="/fengyestudybase/assets/js/41.c99bbfa0.js"><link rel="prefetch" href="/fengyestudybase/assets/js/42.748aa826.js"><link rel="prefetch" href="/fengyestudybase/assets/js/43.67d3a0a7.js"><link rel="prefetch" href="/fengyestudybase/assets/js/5.9688edc8.js"><link rel="prefetch" href="/fengyestudybase/assets/js/6.b4df5c4c.js"><link rel="prefetch" href="/fengyestudybase/assets/js/7.c58bccaa.js"><link rel="prefetch" href="/fengyestudybase/assets/js/8.fb18315f.js"><link rel="prefetch" href="/fengyestudybase/assets/js/9.3c445c9c.js">
    <link rel="stylesheet" href="/fengyestudybase/assets/css/0.styles.5e309cc9.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/fengyestudybase/" class="home-link router-link-active"><!----> <span class="site-name">七色枫叶的学习基地</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/fengyestudybase/" class="nav-link">主页</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">我的学习</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/fengyestudybase/guide/" class="nav-link">前端开发综合知识</a></li><li class="dropdown-item"><!----> <a href="/fengyestudybase/JSbase/" class="nav-link">JS相关</a></li><li class="dropdown-item"><!----> <a href="/fengyestudybase/Webgl/" class="nav-link router-link-active">Webgl相关</a></li><li class="dropdown-item"><!----> <a href="/fengyestudybase/games/" class="nav-link">游戏相关</a></li><li class="dropdown-item"><!----> <a href="/fengyestudybase/readbook/" class="nav-link">读书专题---前端工程化体系设计与实践</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">我的项目</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://chen735623058.github.io/manifestEdit/dist/index.html#/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  manifest编辑器
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div><div class="nav-item"><a href="https://github.com/chen735623058" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/fengyestudybase/" class="nav-link">主页</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">我的学习</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/fengyestudybase/guide/" class="nav-link">前端开发综合知识</a></li><li class="dropdown-item"><!----> <a href="/fengyestudybase/JSbase/" class="nav-link">JS相关</a></li><li class="dropdown-item"><!----> <a href="/fengyestudybase/Webgl/" class="nav-link router-link-active">Webgl相关</a></li><li class="dropdown-item"><!----> <a href="/fengyestudybase/games/" class="nav-link">游戏相关</a></li><li class="dropdown-item"><!----> <a href="/fengyestudybase/readbook/" class="nav-link">读书专题---前端工程化体系设计与实践</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">我的项目</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://chen735623058.github.io/manifestEdit/dist/index.html#/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  manifest编辑器
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div><div class="nav-item"><a href="https://github.com/chen735623058" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/fengyestudybase/Webgl/" class="sidebar-link">主要包括一些Webgl相关的知识</a></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading open"><span>webgl学习</span> <span class="arrow down"></span></p> <ul class="sidebar-group-items"><li><a href="/fengyestudybase/Webgl/2-webgl-入门.html" class="sidebar-link">2-webgl 入门</a></li><li><a href="/fengyestudybase/Webgl/3-webgl-绘制和变换三角形.html" class="sidebar-link">3-绘制和变换三角形</a></li><li><a href="/fengyestudybase/Webgl/4-高级变换与动画基础.html" class="active sidebar-link">4-高级变换和动画基础</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/fengyestudybase/Webgl/4-高级变换与动画基础.html#一、学习要点" class="sidebar-link">一、学习要点</a></li><li class="sidebar-sub-header"><a href="/fengyestudybase/Webgl/4-高级变换与动画基础.html#二、平移然后旋转" class="sidebar-link">二、平移然后旋转</a></li></ul></li><li><a href="/fengyestudybase/Webgl/5-颜色与纹理.html" class="sidebar-link">5-颜色与纹理</a></li><li><a href="/fengyestudybase/Webgl/6-OpenGL ES着色器语言.html" class="sidebar-link">6-OpenGL ES着色器语言</a></li><li><a href="/fengyestudybase/Webgl/7-进入三维世界.html" class="sidebar-link">7-进入三维世界</a></li><li><a href="/fengyestudybase/Webgl/8-光照.html" class="sidebar-link">8-光照</a></li><li><a href="/fengyestudybase/Webgl/9-层次模型.html" class="sidebar-link">9-层次模型</a></li></ul></div></li></ul> </div> <div class="page"> <div class="content"><h1 id="_4-高级变换和动画基础"><a href="#_4-高级变换和动画基础" aria-hidden="true" class="header-anchor">#</a> 4-高级变换和动画基础</h1> <h2 id="一、学习要点"><a href="#一、学习要点" aria-hidden="true" class="header-anchor">#</a> 一、学习要点</h2> <ol><li>进一步研究变化矩阵，并在此基础上制作一些简单的动画效果。</li> <li>学习矩阵变换库</li> <li>实现简单的动画效果。</li></ol> <h2 id="二、平移然后旋转"><a href="#二、平移然后旋转" aria-hidden="true" class="header-anchor">#</a> 二、平移然后旋转</h2> <blockquote><p>本章和后续章节需要使用到一个矩阵库 cuon-matrix.js 可以到我的git项目上去下载</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 修改上一章的旋转矩阵生成方法</span>
<span class="token comment">// 修改前</span>
    <span class="token keyword">var</span> radian <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token constant">PI</span> <span class="token operator">*</span> <span class="token constant">ANGLE</span> <span class="token operator">/</span><span class="token number">180.0</span> <span class="token punctuation">;</span> <span class="token comment">//转为弧度制</span>
    <span class="token keyword">var</span> cosB <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">cos</span><span class="token punctuation">(</span>radian<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> sinB <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">sin</span><span class="token punctuation">(</span>radian<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> xformMatrix <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Float32Array</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
        cosB<span class="token punctuation">,</span>sinB<span class="token punctuation">,</span><span class="token number">0.0</span><span class="token punctuation">,</span><span class="token number">0.0</span><span class="token punctuation">,</span>
        <span class="token operator">-</span>sinB<span class="token punctuation">,</span>cosB<span class="token punctuation">,</span><span class="token number">0.0</span><span class="token punctuation">,</span><span class="token number">0.0</span><span class="token punctuation">,</span>
        <span class="token number">0.0</span><span class="token punctuation">,</span><span class="token number">0.0</span><span class="token punctuation">,</span><span class="token number">1.0</span><span class="token punctuation">,</span><span class="token number">0.0</span><span class="token punctuation">,</span>
        <span class="token number">0.0</span><span class="token punctuation">,</span><span class="token number">0.0</span><span class="token punctuation">,</span><span class="token number">0.0</span><span class="token punctuation">,</span><span class="token number">1.0</span>
    <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 将旋转矩阵传入给顶点着色器</span>
    <span class="token keyword">var</span> u_xformMatrix <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getUniformLocation</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span>program<span class="token punctuation">,</span> <span class="token string">'u_xformMatrix'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    gl<span class="token punctuation">.</span><span class="token function">uniformMatrix4fv</span><span class="token punctuation">(</span>u_xformMatrix<span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">,</span>xformMatrix<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 修改后</span>
    <span class="token keyword">var</span> xformMatrix <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Matrix4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    xformMatrix<span class="token punctuation">.</span><span class="token function">setRotate</span><span class="token punctuation">(</span><span class="token constant">ANGLE</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 将旋转矩阵传入给顶点着色器</span>
    <span class="token keyword">var</span> u_xformMatrix <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getUniformLocation</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span>program<span class="token punctuation">,</span> <span class="token string">'u_xformMatrix'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    gl<span class="token punctuation">.</span><span class="token function">uniformMatrix4fv</span><span class="token punctuation">(</span>u_xformMatrix<span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">,</span>xformMatrix<span class="token punctuation">.</span>elements<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><blockquote><p>Matrix4 对象支持的方法和属性如下图
<img src="https://upload-images.jianshu.io/upload_images/10319049-f3eba7b184d451d6.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="微信图片_20190408162601.png"></p></blockquote> <blockquote><p>复合变换   将变换矩阵相乘 达到符合变换的效果（这种符合变换又叫模型变换 或者建模变换）</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 顶点着色器 修改了下变量名字</span>
<span class="token keyword">var</span> <span class="token constant">VSHANER_SOURCE</span> <span class="token operator">=</span>
    <span class="token template-string"><span class="token string">`
     attribute vec4 a_Position;
     uniform mat4 u_ModelMatrix;
     void main() {
        gl_Position = u_ModelMatrix * a_Position;
     }`</span></span><span class="token punctuation">;</span> 


<span class="token comment">// 平移+旋转 修改上面的main方法</span>
    <span class="token keyword">var</span> xformMatrix <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Matrix4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    xformMatrix<span class="token punctuation">.</span><span class="token function">setRotate</span><span class="token punctuation">(</span><span class="token constant">ANGLE</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    xformMatrix<span class="token punctuation">.</span><span class="token function">translate</span><span class="token punctuation">(</span>Tx<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 将旋转矩阵传入给顶点着色器</span>
    <span class="token keyword">var</span> u_ModelMatrix <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getUniformLocation</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span>program<span class="token punctuation">,</span> <span class="token string">'u_ModelMatrix'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    gl<span class="token punctuation">.</span><span class="token function">uniformMatrix4fv</span><span class="token punctuation">(</span>u_ModelMatrix<span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">,</span>xformMatrix<span class="token punctuation">.</span>elements<span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre></div><h1 id="三、动画"><a href="#三、动画" aria-hidden="true" class="header-anchor">#</a> 三、动画</h1> <blockquote><p>动画的基础： 需要不断擦除和重绘三角形，并且在每次重绘时轻微的改变其角度。
两个关键机制：</p></blockquote> <ol><li>在 t0,t1,t2,t3时刻反复调用同一个函数来绘制三角形。</li> <li>每次绘制之前清除上一次绘制的内容并使三角形旋转。</li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 顶点着色器</span>
<span class="token keyword">var</span> <span class="token constant">VSHANER_SOURCE</span> <span class="token operator">=</span>
    <span class="token template-string"><span class="token string">`
     attribute vec4 a_Position;
     uniform mat4 u_ModelMatrix;
     void main() {
        gl_Position = u_ModelMatrix * a_Position;
     }`</span></span><span class="token punctuation">;</span>
<span class="token comment">// 片元着色器程序</span>
<span class="token keyword">var</span> <span class="token constant">FSHADER_SOURCE</span> <span class="token operator">=</span>
    <span class="token template-string"><span class="token string">`void main() {
        gl_FragColor = vec4(1.0,0.0,0.0,1.0); // 设置颜色
    }`</span></span><span class="token punctuation">;</span>

<span class="token comment">// 旋转速度</span>
<span class="token keyword">var</span> <span class="token constant">ANGLE_STEP</span> <span class="token operator">=</span> <span class="token number">45.0</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> canvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'webgl'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> gl <span class="token operator">=</span> <span class="token function">getWebGLContext</span><span class="token punctuation">(</span>canvas<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>gl<span class="token punctuation">)</span><span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 初始化着色器</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">initShaders</span><span class="token punctuation">(</span>gl<span class="token punctuation">,</span><span class="token constant">VSHANER_SOURCE</span><span class="token punctuation">,</span><span class="token constant">FSHADER_SOURCE</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//******* 设置顶点的位置********</span>
    <span class="token keyword">var</span> n<span class="token operator">=</span><span class="token function">initVertexBuffers</span><span class="token punctuation">(</span>gl<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span><span class="token punctuation">(</span>n<span class="token operator">&lt;</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;error&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 设置背景色 背景色在动画期间一直起作用</span>
    gl<span class="token punctuation">.</span><span class="token function">clearColor</span><span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span><span class="token number">0.0</span><span class="token punctuation">,</span><span class="token number">0.0</span><span class="token punctuation">,</span><span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


    <span class="token comment">// 将旋转矩阵传入给顶点着色器</span>
    <span class="token keyword">var</span> u_ModelMatrix <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getUniformLocation</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span>program<span class="token punctuation">,</span> <span class="token string">'u_ModelMatrix'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 三角形当前旋转的角度</span>
    <span class="token keyword">var</span> currentAngle <span class="token operator">=</span> <span class="token number">0.0</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> modeMatrix <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Matrix4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 开始绘制三角形</span>
    <span class="token keyword">var</span> <span class="token function-variable function">tick</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        currentAngle <span class="token operator">=</span> <span class="token function">animate</span><span class="token punctuation">(</span>currentAngle<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//更新旋转角度</span>
        <span class="token function">draw</span><span class="token punctuation">(</span>gl<span class="token punctuation">,</span>n<span class="token punctuation">,</span>currentAngle<span class="token punctuation">,</span>modeMatrix<span class="token punctuation">,</span>u_ModelMatrix<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span>tick<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//浏览器在适当的时候调用 时间间隔不是固定的</span>
    <span class="token punctuation">}</span>
    <span class="token function">tick</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">initVertexBuffers</span><span class="token punctuation">(</span>gl<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> vertices <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Float32Array</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
        <span class="token number">0.0</span><span class="token punctuation">,</span><span class="token number">0.3</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">0.3</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">0.3</span><span class="token punctuation">,</span><span class="token number">0.3</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">0.3</span>
    <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> n <span class="token operator">=</span><span class="token number">3</span> <span class="token punctuation">;</span> <span class="token comment">// 点的个数</span>
    <span class="token comment">// 创建缓冲区对象</span>
    <span class="token keyword">var</span> vertexBuffer <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">createBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span> vertexBuffer<span class="token punctuation">)</span><span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;error&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 将缓冲区对象绑定到目标</span>
    gl<span class="token punctuation">.</span><span class="token function">bindBuffer</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span>vertexBuffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
    gl<span class="token punctuation">.</span><span class="token function">bufferData</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span>vertices<span class="token punctuation">,</span>gl<span class="token punctuation">.</span><span class="token constant">STATIC_DRAW</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> a_Position <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getAttribLocation</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span>program<span class="token punctuation">,</span><span class="token string">'a_Position'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 将缓冲区对象分配给 a_Position变量</span>
    gl<span class="token punctuation">.</span><span class="token function">vertexAttribPointer</span><span class="token punctuation">(</span>a_Position<span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span>gl<span class="token punctuation">.</span><span class="token constant">FLOAT</span><span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    gl<span class="token punctuation">.</span><span class="token function">enableVertexAttribArray</span><span class="token punctuation">(</span>a_Position<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> n<span class="token punctuation">;</span>
<span class="token punctuation">}</span>


<span class="token keyword">function</span> <span class="token function">draw</span><span class="token punctuation">(</span>gl<span class="token punctuation">,</span>n<span class="token punctuation">,</span>currentAngle<span class="token punctuation">,</span>modelMatrix<span class="token punctuation">,</span>u_ModelMatrix<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    modelMatrix<span class="token punctuation">.</span><span class="token function">setRotate</span><span class="token punctuation">(</span>currentAngle<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 将旋转矩阵传输给顶点着色器</span>
    gl<span class="token punctuation">.</span><span class="token function">uniformMatrix4fv</span><span class="token punctuation">(</span>u_ModelMatrix<span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">,</span>modelMatrix<span class="token punctuation">.</span>elements<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 清除canvas</span>
    gl<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">COLOR_BUFFER_BIT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 绘制三角形</span>
    gl<span class="token punctuation">.</span><span class="token function">drawArrays</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TRIANGLES</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>n<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">var</span> g_last <span class="token operator">=</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">animate</span><span class="token punctuation">(</span>angle<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> now <span class="token operator">=</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> elapsed <span class="token operator">=</span> now <span class="token operator">-</span> g_last<span class="token punctuation">;</span>
    g_last <span class="token operator">=</span> now<span class="token punctuation">;</span>
    <span class="token comment">// 根据距离上次调用的时间 更新当前旋转的角度</span>
    <span class="token keyword">var</span> newAngle <span class="token operator">=</span> angle <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token constant">ANGLE_STEP</span> <span class="token operator">*</span> elapsed<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">1000.0</span>
    <span class="token keyword">return</span> newAngle <span class="token operator">%=</span><span class="token number">360</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><blockquote><p>总结： 复杂变换可以通过基础变化你的矩阵相乘得到。  通过反复变换和重绘图形可以生成动画效果</p></blockquote> <p>下一章我们学习 颜色与纹理</p></div> <div class="page-edit"><!----> <!----></div> <!----> </div> <!----></div></div>
    <script src="/fengyestudybase/assets/js/app.0a47e211.js" defer></script><script src="/fengyestudybase/assets/js/17.0faefb8a.js" defer></script>
  </body>
</html>
