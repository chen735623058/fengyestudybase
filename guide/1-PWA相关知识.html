<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>PWA初始 | 七色枫叶的学习基地</title>
    <meta name="description" content="不积跬步无以至千里，不积小流无以成江河">
    
    
    <link rel="preload" href="/fengyestudybase/assets/css/0.styles.5e309cc9.css" as="style"><link rel="preload" href="/fengyestudybase/assets/js/app.0a47e211.js" as="script"><link rel="preload" href="/fengyestudybase/assets/js/29.98c70977.js" as="script"><link rel="prefetch" href="/fengyestudybase/assets/js/10.30c47e52.js"><link rel="prefetch" href="/fengyestudybase/assets/js/11.4acf0b7f.js"><link rel="prefetch" href="/fengyestudybase/assets/js/12.01897755.js"><link rel="prefetch" href="/fengyestudybase/assets/js/13.927942cf.js"><link rel="prefetch" href="/fengyestudybase/assets/js/14.95996584.js"><link rel="prefetch" href="/fengyestudybase/assets/js/15.2a6554aa.js"><link rel="prefetch" href="/fengyestudybase/assets/js/16.2eacfb27.js"><link rel="prefetch" href="/fengyestudybase/assets/js/17.0faefb8a.js"><link rel="prefetch" href="/fengyestudybase/assets/js/18.dec666b8.js"><link rel="prefetch" href="/fengyestudybase/assets/js/19.61499d52.js"><link rel="prefetch" href="/fengyestudybase/assets/js/2.864db199.js"><link rel="prefetch" href="/fengyestudybase/assets/js/20.a5bcc6c6.js"><link rel="prefetch" href="/fengyestudybase/assets/js/21.48500825.js"><link rel="prefetch" href="/fengyestudybase/assets/js/22.09012641.js"><link rel="prefetch" href="/fengyestudybase/assets/js/23.c64fdaef.js"><link rel="prefetch" href="/fengyestudybase/assets/js/24.fb975750.js"><link rel="prefetch" href="/fengyestudybase/assets/js/25.84edc7a1.js"><link rel="prefetch" href="/fengyestudybase/assets/js/26.48396beb.js"><link rel="prefetch" href="/fengyestudybase/assets/js/27.496aa837.js"><link rel="prefetch" href="/fengyestudybase/assets/js/28.3cd6297d.js"><link rel="prefetch" href="/fengyestudybase/assets/js/3.ae847aa1.js"><link rel="prefetch" href="/fengyestudybase/assets/js/30.92c849a4.js"><link rel="prefetch" href="/fengyestudybase/assets/js/31.6bc95938.js"><link rel="prefetch" href="/fengyestudybase/assets/js/32.d7c431d6.js"><link rel="prefetch" href="/fengyestudybase/assets/js/33.aa073227.js"><link rel="prefetch" href="/fengyestudybase/assets/js/34.fe2e3207.js"><link rel="prefetch" href="/fengyestudybase/assets/js/35.b8405c57.js"><link rel="prefetch" href="/fengyestudybase/assets/js/36.c29f2ab2.js"><link rel="prefetch" href="/fengyestudybase/assets/js/37.9daf48c3.js"><link rel="prefetch" href="/fengyestudybase/assets/js/38.882175dc.js"><link rel="prefetch" href="/fengyestudybase/assets/js/39.bc5c4f62.js"><link rel="prefetch" href="/fengyestudybase/assets/js/4.5053f111.js"><link rel="prefetch" href="/fengyestudybase/assets/js/40.c93261a7.js"><link rel="prefetch" href="/fengyestudybase/assets/js/41.c99bbfa0.js"><link rel="prefetch" href="/fengyestudybase/assets/js/42.748aa826.js"><link rel="prefetch" href="/fengyestudybase/assets/js/43.67d3a0a7.js"><link rel="prefetch" href="/fengyestudybase/assets/js/5.9688edc8.js"><link rel="prefetch" href="/fengyestudybase/assets/js/6.b4df5c4c.js"><link rel="prefetch" href="/fengyestudybase/assets/js/7.c58bccaa.js"><link rel="prefetch" href="/fengyestudybase/assets/js/8.fb18315f.js"><link rel="prefetch" href="/fengyestudybase/assets/js/9.3c445c9c.js">
    <link rel="stylesheet" href="/fengyestudybase/assets/css/0.styles.5e309cc9.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/fengyestudybase/" class="home-link router-link-active"><!----> <span class="site-name">七色枫叶的学习基地</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/fengyestudybase/" class="nav-link">主页</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">我的学习</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/fengyestudybase/guide/" class="nav-link router-link-active">前端开发综合知识</a></li><li class="dropdown-item"><!----> <a href="/fengyestudybase/JSbase/" class="nav-link">JS相关</a></li><li class="dropdown-item"><!----> <a href="/fengyestudybase/Webgl/" class="nav-link">Webgl相关</a></li><li class="dropdown-item"><!----> <a href="/fengyestudybase/games/" class="nav-link">游戏相关</a></li><li class="dropdown-item"><!----> <a href="/fengyestudybase/readbook/" class="nav-link">读书专题---前端工程化体系设计与实践</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">我的项目</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://chen735623058.github.io/manifestEdit/dist/index.html#/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  manifest编辑器
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div><div class="nav-item"><a href="https://github.com/chen735623058" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/fengyestudybase/" class="nav-link">主页</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">我的学习</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/fengyestudybase/guide/" class="nav-link router-link-active">前端开发综合知识</a></li><li class="dropdown-item"><!----> <a href="/fengyestudybase/JSbase/" class="nav-link">JS相关</a></li><li class="dropdown-item"><!----> <a href="/fengyestudybase/Webgl/" class="nav-link">Webgl相关</a></li><li class="dropdown-item"><!----> <a href="/fengyestudybase/games/" class="nav-link">游戏相关</a></li><li class="dropdown-item"><!----> <a href="/fengyestudybase/readbook/" class="nav-link">读书专题---前端工程化体系设计与实践</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">我的项目</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://chen735623058.github.io/manifestEdit/dist/index.html#/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  manifest编辑器
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div><div class="nav-item"><a href="https://github.com/chen735623058" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/fengyestudybase/guide/" class="sidebar-link">主要包括一些前端开发的相关知识</a></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading open"><span>前端开发综合知识</span> <span class="arrow down"></span></p> <ul class="sidebar-group-items"><li><a href="/fengyestudybase/guide/1-PWA相关知识.html" class="active sidebar-link">PWA初始</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/fengyestudybase/guide/1-PWA相关知识.html#一、对pwa的一些自己的理解" class="sidebar-link">一、对PWA的一些自己的理解</a></li><li class="sidebar-sub-header"><a href="/fengyestudybase/guide/1-PWA相关知识.html#二、使用manifest在主屏添加app图标" class="sidebar-link">二、使用Manifest在主屏添加app图标</a></li><li class="sidebar-sub-header"><a href="/fengyestudybase/guide/1-PWA相关知识.html#三、service-worker增加离线的能力" class="sidebar-link">三、Service Worker增加离线的能力</a></li></ul></li><li><a href="/fengyestudybase/guide/2-二 八 十 十六进制转换.html" class="sidebar-link">二 八 十 十六进制转换</a></li><li><a href="/fengyestudybase/guide/3-懒加载相关实现技术.html" class="sidebar-link">懒加载相关实现技术</a></li></ul></div></li></ul> </div> <div class="page"> <div class="content"><h1 id="pwa初始"><a href="#pwa初始" aria-hidden="true" class="header-anchor">#</a> PWA初始</h1> <h2 id="一、对pwa的一些自己的理解"><a href="#一、对pwa的一些自己的理解" aria-hidden="true" class="header-anchor">#</a> 一、对PWA的一些自己的理解</h2> <blockquote><p>PWA全称Progressive Web App，即渐进式WEB应用。一种可以提供类似于原生应用程序(native app)体验的网络应用程序(web app)。PWA 可以用来做很多事。其中最重要的是，在离线(offline)时应用程序能够继续运行功能。这是通过使用名为 Service Workers 的网络技术来实现的。</p></blockquote> <ol><li><p>首先 PWA 仍然是一个网页。他不是一向新的框架或者新的技术，他是一系列Web技术的集合</p></li> <li><p>PWA 使用到的主要技术有哪些呢？ 他们是做什么的？</p> <table><thead><tr><th>使用到的技术</th> <th>作用</th></tr></thead> <tbody><tr><td>Web App Manifest</td> <td>在主屏添加app图标 定义手机标题栏和隐藏导航栏</td></tr> <tr><td>Service Worker</td> <td>用来实现离线</td></tr> <tr><td>Cache API 缓存技术</td> <td>用来实现离线应用</td></tr> <tr><td>Push Notification</td> <td>消息推送</td></tr></tbody></table></li></ol> <h2 id="二、使用manifest在主屏添加app图标"><a href="#二、使用manifest在主屏添加app图标" aria-hidden="true" class="header-anchor">#</a> 二、使用Manifest在主屏添加app图标</h2> <ol><li>chrome浏览器拥有将网页添加到手机主屏的功能。当点击这个选项后，会在主屏上增加一个网页的快捷方式。如下图</li></ol> <p><img src="https://upload-images.jianshu.io/upload_images/10319049-457a52612f71ff07.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="图1.png"></p> <ol start="2"><li>如果想让这个快捷方式更像原生应用，需要解决几个问题(这些问题manifest可以帮你解决)。</li></ol> <blockquote><p>2.1 要有自己的应用图标。<br>
2.2 打开时显示一个开屏图（不要有白屏）。<br>
2.3 不要出现地址栏</p></blockquote> <ol start="3"><li>添加manifest的步骤。</li></ol> <blockquote><p>3.1 新建一个web项目文件夹，新增配置一个manifest.json的文件，参数说明。
<a href="https://developer.mozilla.org/zh-CN/docs/Web/Manifest" target="_blank" rel="noopener noreferrer">Web App Manifest（MDN）<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></blockquote> <div class="language-json extra-class"><pre class="language-json"><code>    <span class="token punctuation">{</span>
    <span class="token property">&quot;name&quot;</span><span class="token operator">:</span><span class="token string">&quot;一个PWA示例&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;short_name&quot;</span><span class="token operator">:</span><span class="token string">&quot;PWA示例&quot;</span><span class="token punctuation">,</span> // 应用显示在主屏的名字
    <span class="token property">&quot;start_url&quot;</span><span class="token operator">:</span><span class="token string">&quot;/index.html&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;display&quot;</span><span class="token operator">:</span><span class="token string">&quot;standalone&quot;</span><span class="token punctuation">,</span> // 设置启动样式，让你的网络应用隐藏浏览器的URL地址栏
    <span class="token property">&quot;background_color&quot;</span><span class="token operator">:</span><span class="token string">&quot;#fff&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;theme_color&quot;</span><span class="token operator">:</span><span class="token string">&quot;#3eaf7c&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;icons&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
        <span class="token property">&quot;src&quot;</span><span class="token operator">:</span><span class="token string">&quot;/icon.png&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;sizes&quot;</span><span class="token operator">:</span><span class="token string">&quot;120x120&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;types&quot;</span><span class="token operator">:</span><span class="token string">&quot;image/png&quot;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
</code></pre></div><blockquote><p>3.2 然后在新建index页面，在页面中新增一条link。就OK拉 。去看看现在在主屏创建的效果。</p></blockquote> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>manifest<span class="token punctuation">&quot;</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>/manifest.json<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>效果如下图</p> <p><img src="https://upload-images.jianshu.io/upload_images/10319049-e8fca87ee5e140cb.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="图2.png"></p> <h2 id="三、service-worker增加离线的能力"><a href="#三、service-worker增加离线的能力" aria-hidden="true" class="header-anchor">#</a> 三、Service Worker增加离线的能力</h2> <h3 id="什么是service-worker？解释在这里"><a href="#什么是service-worker？解释在这里" aria-hidden="true" class="header-anchor">#</a> 什么是Service Worker？<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Service_Worker_API" target="_blank" rel="noopener noreferrer">解释在这里<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h3> <p>说一说我自己的理解，Service Worker我认为就好像一个运行在你本机中的软件，这个软件起到一个代理的作用，可以截获页面到服务器的请求（缓存离线），并可以接受服务器的消息（推送订阅），他的表现形式是运行一个js文件。特殊的点是：</p> <ol><li>它的下载是通过首次访问有Service Worker支持的网站时下载的。每24小时充实下载一次，当然也可能更频繁。在首次下载后 页面会直接安装它。安装完以后它会被激活。</li> <li>它是在浏览器主进程之外单独跑的一个后台进程，这个进程跑的方法是在我们自己写的Service Worker中定义。</li> <li>即使你离开了浏览器，这个Service Worker 也不会消失 仍然会在应用背后运行。</li></ol> <blockquote><p>他的生命周期为
<br>install -&gt; installed -&gt; actvating -&gt; Active -&gt; Activated -&gt; Redundant
进入 Redundat状态的条件是：</p></blockquote> <ul><li>安装(install)失败</li> <li>激活(activating)失败</li> <li>新版本的 Service Worker 替换了它并成为激活状态
<br> （另外注意的是 Service Worker只能运行在https的域名下 或则是 localhost的本机调试中。我们可以用gitbutpage来做，很方便 后面会有演示）
<img src="https://upload-images.jianshu.io/upload_images/10319049-e89db8379f182652.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="图3.png"></li></ul> <h3 id="使用service-worker实现离线"><a href="#使用service-worker实现离线" aria-hidden="true" class="header-anchor">#</a> 使用Service Worker实现离线</h3> <p>（代码都放到了gitpage上了。<a href="https://github.com/chen735623058/testPWA" target="_blank" rel="noopener noreferrer">地址点击这里<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>）。
<br>实现代码说明：</p> <ol><li>在html页面中注册Service Worker。注册前别忘了检验一下浏览器是否支持。注册后你的页面就拥有了Service Worker能力了 只不过现在它还啥都没做。</li></ol> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script language-javascript">
    <span class="token comment">// 检测浏览器是否支持SW</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>navigator<span class="token punctuation">.</span>serviceWorker <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">// 其中sxf_sw.js就是我们实现Service worker方法的js文件</span>
		navigator<span class="token punctuation">.</span>serviceWorker<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span><span class="token string">'sxf_sw.js'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span>registortion<span class="token punctuation">)</span><span class="token punctuation">{</span>
			console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'支持sw'</span><span class="token punctuation">,</span> registortion<span class="token punctuation">.</span>scope<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">catch</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span>whut<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'service worker has registered failure!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><ol start="2"><li>编写sxf_sw.js，文件 让他拥有相应的能力。</li></ol> <div class="language-js extra-class"><pre class="language-js"><code>    <span class="token comment">//cachestorage名称，可以加上版本号予以区分</span>
    <span class="token keyword">const</span> <span class="token constant">OFFLINE_CACHE_PREFIX</span> <span class="token operator">=</span> <span class="token string">'sxf_offline_page_'</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token constant">CACHE_VERSION</span> <span class="token operator">=</span> <span class="token string">'v1.0'</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token constant">OFFLINE_CACHE_NAME</span> <span class="token operator">=</span> <span class="token constant">OFFLINE_CACHE_PREFIX</span> <span class="token operator">+</span> <span class="token constant">CACHE_VERSION</span><span class="token punctuation">;</span>

    <span class="token comment">//Service Worker安装事件，其中可以预缓存资源</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'install'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'install'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//需要缓存的页面资源这里缓存了三个资源。在安装过程中最好不要缓存太多，可能导致安装失败</span>
        <span class="token keyword">var</span> urlsToPrefetch <span class="token operator">=</span> <span class="token punctuation">[</span>
            <span class="token string">'index.html'</span><span class="token punctuation">,</span>
            <span class="token string">'main.css'</span><span class="token punctuation">,</span>
            <span class="token string">'icon.png'</span>
        <span class="token punctuation">]</span><span class="token punctuation">;</span>

        event<span class="token punctuation">.</span><span class="token function">waitUntil</span><span class="token punctuation">(</span>
            caches<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token constant">OFFLINE_CACHE_NAME</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>cache<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span> cache<span class="token punctuation">.</span><span class="token function">addAll</span><span class="token punctuation">(</span>urlsToPrefetch<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//Service Worker激活事件</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'activate'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//在激活事件中清除非当前版本的缓存避免用户存储空间急剧膨胀</span>
        event<span class="token punctuation">.</span><span class="token function">waitUntil</span><span class="token punctuation">(</span>caches<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>cacheNames<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span>cacheNames<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>cacheName<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>cacheName <span class="token operator">!==</span> <span class="token constant">OFFLINE_CACHE_NAME</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token keyword">if</span><span class="token punctuation">(</span>cacheName<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token constant">OFFLINE_CACHE_PREFIX</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token keyword">return</span> caches<span class="token punctuation">.</span><span class="token keyword">delete</span><span class="token punctuation">(</span>cacheName<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


    <span class="token comment">//Service Worker 请求拦截事件</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'fetch'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span>  <span class="token punctuation">{</span>
        event<span class="token punctuation">.</span><span class="token function">respondWith</span><span class="token punctuation">(</span>
            caches<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token constant">OFFLINE_CACHE_NAME</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>cache<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span> cache<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>request<span class="token punctuation">.</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token comment">//response为空表明未匹配成功，交由fetch方法去网络拉取</span>
                <span class="token keyword">if</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token keyword">return</span> response<span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token keyword">return</span> <span class="token function">fetch</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ol start="3"><li>当功能写完以后如何测试我们的功能是否成功呢？这里使用gitpage</li></ol> <ul><li><p>先注册一个git的仓库。将代码上传到这个仓库里面。然后点击Settings选项卡。配置gitpage页面如下图
<img src="https://upload-images.jianshu.io/upload_images/10319049-4730c2c3900b66de.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="图4"></p></li> <li><p>进入Settings 标签后将，找到下面的Github Pages中的source选项。选择master branch。如下图
<img src="https://upload-images.jianshu.io/upload_images/10319049-2712564f7b0de0ff.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="图5.png">
点击确定后就可以在上面看到你的GitHubPages地址了。然后拷贝这个地址。在后面加上index.html。
进入页面。可以看到Hello PWA。然后点击F12进入开发者控制台。选择Application选项。并选择左侧的Service Workers可以看到如下图。
<img src="https://upload-images.jianshu.io/upload_images/10319049-5bf8e06cfbcd85ae.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="图6.png"></p></li></ul> <ol start="4"><li>更新缓存时 只需要修改CACHE_VERSION 这个变量就可以了。</li></ol> <h3 id="使用service-worker实现推送订阅功能"><a href="#使用service-worker实现推送订阅功能" aria-hidden="true" class="header-anchor">#</a> 使用Service Worker实现推送订阅功能</h3> <p>（这一部分有个讲的非常好的blog我也是受益匪浅 <a href="https://github.com/alienzhou/learning-pwa/tree/push" target="_blank" rel="noopener noreferrer">地址点击这里<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>）
下面桌一些自己的理解：
(1) 推送订阅的实现原理并非是我们原来的长连接 或者WebsocketD的形式。它使用了一种叫Web Push的技术。在web push中有三方。</p> <ul><li>浏览器：也就是我们的客户端</li> <li>Push Service: 这个由浏览器厂商提供，Chrome 和 firefox都有自己的。</li> <li>后端服务：我们自己的服务。下图是引用 协议草案的流程图</li></ul> <div class="language- extra-class"><pre class="language-text"><code>   +-------+           +--------------+       +-------------+
   |  UA   |           | Push Service |       | Application |
   +-------+           +--------------+       |   Server    |
       |                      |               +-------------+
       |      Subscribe       |                      |
       |---------------------&gt;|                      |
       |       Monitor        |                      |
       |&lt;====================&gt;|                      |
       |                      |                      |
       |          Distribute Push Resource           |
       |--------------------------------------------&gt;|
       |                      |                      |
       :                      :                      :
       |                      |     Push Message     |
       |    Push Message      |&lt;---------------------|
       |&lt;---------------------|                      |
       |                      |                      |
</code></pre></div><p>步骤说明：</p> <ol><li>现在浏览器端订阅消息服务。（这个订阅是和PUSH Service 订阅）。订阅成功后会得到一个PushSubscription 对象。</li> <li>将这个对象的信息发送给我们的后端服务。</li> <li>我们后端服务通过使用 web-push 这个组件的方法可以将消息推送给Push Service。 推送是需要用到 PushSubscription 对象中的endpoint</li> <li>Push Service 根据传递过来的endpoint 找到对应的浏览器，将消息推送给浏览器上的Service Worker 。</li> <li>浏览器的 Service Worker 通过监听 push方法可以将数据得到并进行处理。</li></ol> <p>在数据的传输过程中需要用到一对公钥私钥进行签名加密，以保证浏览器接收到的信息是自己服务器发送出来的。</p> <p>(2) 一个没有后台服务的简单实现前端订阅的代码和测试方法。</p> <p>首先改造我们上面的 index.html 页面的 js 方法如下代码</p> <div class="language-js extra-class"><pre class="language-js"><code>	<span class="token comment">// 检测浏览器是否支持SW</span>
        <span class="token comment">/**
         * base64的相关操作，具体可以参考
         * https://github.com/web-push-libs/web-push#using-vapid-key-for-applicationserverkey
         */</span>
        window<span class="token punctuation">.</span><span class="token function-variable function">urlBase64ToUint8Array</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>base64String<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">const</span> padding <span class="token operator">=</span> <span class="token string">'='</span><span class="token punctuation">.</span><span class="token function">repeat</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">4</span> <span class="token operator">-</span> base64String<span class="token punctuation">.</span>length <span class="token operator">%</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">const</span> base64 <span class="token operator">=</span> <span class="token punctuation">(</span>base64String <span class="token operator">+</span> padding<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex">/\-/g</span><span class="token punctuation">,</span> <span class="token string">'+'</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex">/_/g</span><span class="token punctuation">,</span> <span class="token string">'/'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">const</span> rawData <span class="token operator">=</span> window<span class="token punctuation">.</span><span class="token function">atob</span><span class="token punctuation">(</span>base64<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">const</span> outputArray <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Uint8Array</span><span class="token punctuation">(</span>rawData<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> rawData<span class="token punctuation">.</span>length<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                outputArray<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> rawData<span class="token punctuation">.</span><span class="token function">charCodeAt</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">return</span> outputArray<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

		<span class="token comment">// if(navigator.serviceWorker != null){</span>
		<span class="token comment">// 	navigator.serviceWorker.register('sxf_sw.js').then(function (registortion) {</span>
		<span class="token comment">// 		console.log('支持sw', registortion.scope);</span>
		<span class="token comment">// 	}).catch(function (whut) {</span>
		<span class="token comment">// 		console.log('service worker has registered failure!');</span>
		<span class="token comment">// 	})</span>
		<span class="token comment">// }</span>

        <span class="token keyword">function</span> <span class="token function">registerServiceWorker</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> navigator<span class="token punctuation">.</span>serviceWorker<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">function</span> <span class="token function">subscribeUserToPush</span><span class="token punctuation">(</span>registration<span class="token punctuation">,</span> publicKey<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">var</span> subscribeOptions <span class="token operator">=</span> <span class="token punctuation">{</span>
                userVisibleOnly<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
                applicationServerKey<span class="token punctuation">:</span> window<span class="token punctuation">.</span><span class="token function">urlBase64ToUint8Array</span><span class="token punctuation">(</span>publicKey<span class="token punctuation">)</span>
            <span class="token punctuation">}</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> registration<span class="token punctuation">.</span>pushManager<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span>subscribeOptions<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span>pushSubscription<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Received PushSubscription: '</span><span class="token punctuation">,</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>pushSubscription<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span> pushSubscription<span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">'serviceWorker'</span> <span class="token keyword">in</span> navigator <span class="token operator">&amp;&amp;</span> <span class="token string">'PushManager'</span> <span class="token keyword">in</span> window<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">var</span> publicKey <span class="token operator">=</span> <span class="token string">'BOEQSjdhorIf8M0XFNlwohK3sTzO9iJwvbYU-fuXRF0tvRpPPMGO6d_gJC_pUQwBT7wD8rKutpNTFHOHN3VqJ0A'</span><span class="token punctuation">;</span>
            <span class="token comment">// 注册service worker</span>
            <span class="token function">registerServiceWorker</span><span class="token punctuation">(</span><span class="token string">'sxf_sw.js'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span>registration<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Service Worker 注册成功'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">// 开启该客户端的消息推送订阅功能</span>
                <span class="token keyword">return</span> <span class="token function">subscribeUserToPush</span><span class="token punctuation">(</span>registration<span class="token punctuation">,</span> publicKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span>subscription<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">var</span> body <span class="token operator">=</span> <span class="token punctuation">{</span>subscription<span class="token punctuation">:</span> subscription<span class="token punctuation">}</span><span class="token punctuation">;</span>
                <span class="token comment">// 为了方便之后的推送，为每个客户端简单生成一个标识</span>
                body<span class="token punctuation">.</span>uniqueid <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'uniqueid'</span><span class="token punctuation">,</span> body<span class="token punctuation">.</span>uniqueid<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">// 将生成的客户端订阅信息存储在自己的服务器上</span>
                <span class="token keyword">return</span> <span class="token function">sendSubscriptionToServer</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>body<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">catch</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>


        <span class="token keyword">function</span> <span class="token function">sendSubscriptionToServer</span> <span class="token punctuation">(</span>endpointobj<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;存储成功&quot;</span><span class="token operator">+</span>endpointobj<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
</code></pre></div><p>然后在 sxf_sw.js 中增加方法</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 监听推送的消息</span>
self<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'push'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> data <span class="token operator">=</span> e<span class="token punctuation">.</span>data<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>data<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        data <span class="token operator">=</span> data<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'push的数据为：'</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span>
        self<span class="token punctuation">.</span>registration<span class="token punctuation">.</span><span class="token function">showNotification</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>text<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'push没有任何数据'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>测试时 打开页面，浏览器会询问是否允许通知，点击允许。然后和测试一样进入下图画面
<img src="https://upload-images.jianshu.io/upload_images/10319049-7af4498adffe76da.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="图7.png"></p> <p>此上就是对PWA的浅薄学习，如果有说的不对的 请大家指出</p></div> <div class="page-edit"><!----> <!----></div> <!----> </div> <!----></div></div>
    <script src="/fengyestudybase/assets/js/app.0a47e211.js" defer></script><script src="/fengyestudybase/assets/js/29.98c70977.js" defer></script>
  </body>
</html>
