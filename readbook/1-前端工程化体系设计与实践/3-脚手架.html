<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>脚手架 | 七色枫叶的学习基地</title>
    <meta name="description" content="不积跬步无以至千里，不积小流无以成江河">
    
    
    <link rel="preload" href="/fengyestudybase/assets/css/0.styles.5e309cc9.css" as="style"><link rel="preload" href="/fengyestudybase/assets/js/app.0a47e211.js" as="script"><link rel="preload" href="/fengyestudybase/assets/js/36.c29f2ab2.js" as="script"><link rel="prefetch" href="/fengyestudybase/assets/js/10.30c47e52.js"><link rel="prefetch" href="/fengyestudybase/assets/js/11.4acf0b7f.js"><link rel="prefetch" href="/fengyestudybase/assets/js/12.01897755.js"><link rel="prefetch" href="/fengyestudybase/assets/js/13.927942cf.js"><link rel="prefetch" href="/fengyestudybase/assets/js/14.95996584.js"><link rel="prefetch" href="/fengyestudybase/assets/js/15.2a6554aa.js"><link rel="prefetch" href="/fengyestudybase/assets/js/16.2eacfb27.js"><link rel="prefetch" href="/fengyestudybase/assets/js/17.0faefb8a.js"><link rel="prefetch" href="/fengyestudybase/assets/js/18.dec666b8.js"><link rel="prefetch" href="/fengyestudybase/assets/js/19.61499d52.js"><link rel="prefetch" href="/fengyestudybase/assets/js/2.864db199.js"><link rel="prefetch" href="/fengyestudybase/assets/js/20.a5bcc6c6.js"><link rel="prefetch" href="/fengyestudybase/assets/js/21.48500825.js"><link rel="prefetch" href="/fengyestudybase/assets/js/22.09012641.js"><link rel="prefetch" href="/fengyestudybase/assets/js/23.c64fdaef.js"><link rel="prefetch" href="/fengyestudybase/assets/js/24.fb975750.js"><link rel="prefetch" href="/fengyestudybase/assets/js/25.84edc7a1.js"><link rel="prefetch" href="/fengyestudybase/assets/js/26.48396beb.js"><link rel="prefetch" href="/fengyestudybase/assets/js/27.496aa837.js"><link rel="prefetch" href="/fengyestudybase/assets/js/28.3cd6297d.js"><link rel="prefetch" href="/fengyestudybase/assets/js/29.98c70977.js"><link rel="prefetch" href="/fengyestudybase/assets/js/3.ae847aa1.js"><link rel="prefetch" href="/fengyestudybase/assets/js/30.92c849a4.js"><link rel="prefetch" href="/fengyestudybase/assets/js/31.6bc95938.js"><link rel="prefetch" href="/fengyestudybase/assets/js/32.d7c431d6.js"><link rel="prefetch" href="/fengyestudybase/assets/js/33.aa073227.js"><link rel="prefetch" href="/fengyestudybase/assets/js/34.fe2e3207.js"><link rel="prefetch" href="/fengyestudybase/assets/js/35.b8405c57.js"><link rel="prefetch" href="/fengyestudybase/assets/js/37.9daf48c3.js"><link rel="prefetch" href="/fengyestudybase/assets/js/38.882175dc.js"><link rel="prefetch" href="/fengyestudybase/assets/js/39.bc5c4f62.js"><link rel="prefetch" href="/fengyestudybase/assets/js/4.5053f111.js"><link rel="prefetch" href="/fengyestudybase/assets/js/40.c93261a7.js"><link rel="prefetch" href="/fengyestudybase/assets/js/41.c99bbfa0.js"><link rel="prefetch" href="/fengyestudybase/assets/js/42.748aa826.js"><link rel="prefetch" href="/fengyestudybase/assets/js/43.67d3a0a7.js"><link rel="prefetch" href="/fengyestudybase/assets/js/5.9688edc8.js"><link rel="prefetch" href="/fengyestudybase/assets/js/6.b4df5c4c.js"><link rel="prefetch" href="/fengyestudybase/assets/js/7.c58bccaa.js"><link rel="prefetch" href="/fengyestudybase/assets/js/8.fb18315f.js"><link rel="prefetch" href="/fengyestudybase/assets/js/9.3c445c9c.js">
    <link rel="stylesheet" href="/fengyestudybase/assets/css/0.styles.5e309cc9.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/fengyestudybase/" class="home-link router-link-active"><!----> <span class="site-name">七色枫叶的学习基地</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/fengyestudybase/" class="nav-link">主页</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">我的学习</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/fengyestudybase/guide/" class="nav-link">前端开发综合知识</a></li><li class="dropdown-item"><!----> <a href="/fengyestudybase/JSbase/" class="nav-link">JS相关</a></li><li class="dropdown-item"><!----> <a href="/fengyestudybase/Webgl/" class="nav-link">Webgl相关</a></li><li class="dropdown-item"><!----> <a href="/fengyestudybase/games/" class="nav-link">游戏相关</a></li><li class="dropdown-item"><!----> <a href="/fengyestudybase/readbook/" class="nav-link router-link-active">读书专题---前端工程化体系设计与实践</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">我的项目</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://chen735623058.github.io/manifestEdit/dist/index.html#/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  manifest编辑器
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div><div class="nav-item"><a href="https://github.com/chen735623058" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/fengyestudybase/" class="nav-link">主页</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">我的学习</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/fengyestudybase/guide/" class="nav-link">前端开发综合知识</a></li><li class="dropdown-item"><!----> <a href="/fengyestudybase/JSbase/" class="nav-link">JS相关</a></li><li class="dropdown-item"><!----> <a href="/fengyestudybase/Webgl/" class="nav-link">Webgl相关</a></li><li class="dropdown-item"><!----> <a href="/fengyestudybase/games/" class="nav-link">游戏相关</a></li><li class="dropdown-item"><!----> <a href="/fengyestudybase/readbook/" class="nav-link router-link-active">读书专题---前端工程化体系设计与实践</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">我的项目</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://chen735623058.github.io/manifestEdit/dist/index.html#/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  manifest编辑器
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div><div class="nav-item"><a href="https://github.com/chen735623058" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/fengyestudybase/readbook/" class="sidebar-link">学习前端工程化体系一书的笔记和心得</a></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading open"><span>前端工程化读书笔记</span> <span class="arrow down"></span></p> <ul class="sidebar-group-items"><li><a href="/fengyestudybase/readbook/1-前端工程化体系设计与实践/1-前言.html" class="sidebar-link">前言</a></li><li><a href="/fengyestudybase/readbook/1-前端工程化体系设计与实践/2-前端工程简史.html" class="sidebar-link">前端工程简史</a></li><li><a href="/fengyestudybase/readbook/1-前端工程化体系设计与实践/3-脚手架.html" class="active sidebar-link">脚手架</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/fengyestudybase/readbook/1-前端工程化体系设计与实践/3-脚手架.html#_1-学习要点" class="sidebar-link">1. 学习要点</a></li><li class="sidebar-sub-header"><a href="/fengyestudybase/readbook/1-前端工程化体系设计与实践/3-脚手架.html#_2-脚手架的功能和本质" class="sidebar-link">2. 脚手架的功能和本质</a></li><li class="sidebar-sub-header"><a href="/fengyestudybase/readbook/1-前端工程化体系设计与实践/3-脚手架.html#_3-脚手架在前端工程汇总的角色和特征" class="sidebar-link">3. 脚手架在前端工程汇总的角色和特征</a></li><li class="sidebar-sub-header"><a href="/fengyestudybase/readbook/1-前端工程化体系设计与实践/3-脚手架.html#_4-开源脚手架案例剖析" class="sidebar-link">4. 开源脚手架案例剖析</a></li><li class="sidebar-sub-header"><a href="/fengyestudybase/readbook/1-前端工程化体系设计与实践/3-脚手架.html#_5-集成yeoman-封装脚手架方案" class="sidebar-link">5. 集成Yeoman 封装脚手架方案</a></li><li class="sidebar-sub-header"><a href="/fengyestudybase/readbook/1-前端工程化体系设计与实践/3-脚手架.html#_6-总结" class="sidebar-link">6.总结</a></li></ul></li><li><a href="/fengyestudybase/readbook/1-前端工程化体系设计与实践/4-项目构建.html" class="sidebar-link">工程构建</a></li><li><a href="/fengyestudybase/readbook/1-前端工程化体系设计与实践/5-本地开发服务器.html" class="sidebar-link">本地开发服务器</a></li><li><a href="/fengyestudybase/readbook/1-前端工程化体系设计与实践/6-部署.html" class="sidebar-link">部署</a></li></ul></div></li></ul> </div> <div class="page"> <div class="content"><h1 id="脚手架"><a href="#脚手架" aria-hidden="true" class="header-anchor">#</a> 脚手架</h1> <h2 id="_1-学习要点"><a href="#_1-学习要点" aria-hidden="true" class="header-anchor">#</a> 1. 学习要点</h2> <ul><li>探讨脚手架的本质和功能</li> <li>脚手架在前端工程中的角色和特征</li> <li>典型脚手架案例分析</li> <li>yeoman脚手架集成方案</li></ul> <h2 id="_2-脚手架的功能和本质"><a href="#_2-脚手架的功能和本质" aria-hidden="true" class="header-anchor">#</a> 2. 脚手架的功能和本质</h2> <blockquote><p>用一句话概括功能是：创建项目初始文件。</p></blockquote> <blockquote><p>脚手架的本质： 方案的封装</p></blockquote> <h2 id="_3-脚手架在前端工程汇总的角色和特征"><a href="#_3-脚手架在前端工程汇总的角色和特征" aria-hidden="true" class="header-anchor">#</a> 3. 脚手架在前端工程汇总的角色和特征</h2> <blockquote><p>用完即弃的发起者角色
脚手架的价值在于</p></blockquote> <ol><li>快速生成配置</li> <li>降低框架的学习成本</li> <li>令业务开发人员关注业务逻辑本身</li></ol> <p>Vue-cil就是一个非常典型的例子，提供了模板选择，编译，本地开发服务器等功能模块。</p> <blockquote><p>局限于本地的执行环境</p></blockquote> <p>无论是本地工具链的工程化形式 还是持续集成的工程化形式，脚手架的执行环境始终局限于本地。所以必须解决操作系统兼容性的问他们。</p> <blockquote><p>多样性的实现模式
无论具体模式如何，优秀的脚手架工具应遵循的原则是一致的。</p></blockquote> <ul><li>与构建、开发、部署等功能模块联动，在创建项目时生成对应的配置</li> <li>自动安装依赖模块</li> <li>动态可配置</li> <li>底层高度可扩展</li> <li>丰富而不繁琐的配置项</li> <li>支持多种运行环境，比如命令行和Node.js API</li> <li>兼容主流操作系统</li></ul> <h2 id="_4-开源脚手架案例剖析"><a href="#_4-开源脚手架案例剖析" aria-hidden="true" class="header-anchor">#</a> 4. 开源脚手架案例剖析</h2> <blockquote><p>Sails.js 针对服务器端的脚手架方案</p></blockquote> <blockquote><p>yeoman 脚手架方案</p></blockquote> <h2 id="_5-集成yeoman-封装脚手架方案"><a href="#_5-集成yeoman-封装脚手架方案" aria-hidden="true" class="header-anchor">#</a> 5. 集成Yeoman 封装脚手架方案</h2> <blockquote><p>整体的流程是： 收集用户的配置信息 ---&gt; 将动态的配置信息转换成静态的文件内容(yeoman 使用的是ejs引擎) ---&gt; 将生成的文件复制到目标文件夹。</p></blockquote> <blockquote><p>封装脚手架方案</p></blockquote> <p>创建一个完整的空的脚手架文件目录。</p> <p><img src="https://upload-images.jianshu.io/upload_images/10319049-f282d740348a405b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="微信图片_20190513173144.png"></p> <ul><li>app目录是源码文件</li> <li>index.js是执行入口文件</li> <li>templates 是脚手架所封装方案的项目文件源码</li> <li>_prompts是用户提示用户配置的选项内容的</li></ul> <p>或者使用 npm install -g generator-generator 的模板创建一个generator项目这样index里面会有相应的代码了。
然后根据下面步骤编写 index.js文件代码。这个代码并不完整，只是用来后面讲解各部分内容时的一个参考</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token string">'use strict'</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> Generators  <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'yeoman-generator'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> chalk <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'chalk'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> yosay <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'yosay'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> Path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> _ <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'lodash'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token keyword">class</span> <span class="token class-name">extends</span> Generators  <span class="token punctuation">{</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span>args<span class="token punctuation">,</span> opts<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span>args<span class="token punctuation">,</span> opts<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// argument appname is not required</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">argument</span><span class="token punctuation">(</span><span class="token string">'appname'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
            desc<span class="token punctuation">:</span> <span class="token string">'project name'</span><span class="token punctuation">,</span>
            type<span class="token punctuation">:</span> String<span class="token punctuation">,</span>
            required<span class="token punctuation">:</span> <span class="token boolean">false</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// current选项代表是否在当前目录文件夹中创建项目</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">option</span><span class="token punctuation">(</span><span class="token string">'current'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
            desc<span class="token punctuation">:</span> <span class="token string">'generate app in current folder'</span><span class="token punctuation">,</span>
            type<span class="token punctuation">:</span> Boolean<span class="token punctuation">,</span>
            alias<span class="token punctuation">:</span> <span class="token string">'c'</span><span class="token punctuation">,</span>
            required<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
            <span class="token keyword">default</span><span class="token punctuation">:</span> <span class="token boolean">false</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token function">prompting</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 这个方法负责用户提示和配置收集</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>
            <span class="token function">yosay</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`Welcome to the wicked </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>chalk<span class="token punctuation">.</span><span class="token function">red</span><span class="token punctuation">(</span><span class="token string">'generator-vuegenerator'</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> generator!`</span></span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">const</span> prompts <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./_prompts/_js.js'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./_prompts/_style.js'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./_prompts/_html.js'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">prompt</span><span class="token punctuation">(</span>prompts<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>res <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
           <span class="token keyword">let</span> appname <span class="token operator">=</span> res<span class="token punctuation">.</span>appname <span class="token operator">||</span> <span class="token keyword">this</span><span class="token punctuation">.</span>options<span class="token punctuation">.</span>appname<span class="token punctuation">;</span>
           <span class="token keyword">let</span> options <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> res<span class="token punctuation">,</span> <span class="token punctuation">{</span>
               appname
           <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token keyword">this</span><span class="token punctuation">.</span>pkg <span class="token operator">=</span> options<span class="token punctuation">.</span>nodeModules<span class="token punctuation">;</span>
           <span class="token keyword">this</span><span class="token punctuation">.</span>renderOpts <span class="token operator">=</span> options<span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token function">writing</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 负责文件操作</span>
        <span class="token comment">// destFolder 项目所在的目录</span>
        <span class="token comment">// current 是否在当前目录创建</span>
        <span class="token keyword">const</span> destFolder  <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>options<span class="token punctuation">.</span>current <span class="token operator">?</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">:</span> Path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>options<span class="token punctuation">.</span>appname <span class="token punctuation">,</span> <span class="token string">'/'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 生成boi-conf.js文件</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>fs<span class="token punctuation">.</span><span class="token function">copyTpl</span><span class="token punctuation">(</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">templatePath</span><span class="token punctuation">(</span><span class="token string">'boi-conf.ejs'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">destinationPath</span><span class="token punctuation">(</span>Path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>destFolder<span class="token punctuation">,</span><span class="token string">'boi-conf.js'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>renderOpts
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>fs<span class="token punctuation">.</span><span class="token function">copyTpl</span><span class="token punctuation">(</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">templatePath</span><span class="token punctuation">(</span><span class="token string">'index.app.ejs'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">destinationPath</span><span class="token punctuation">(</span>Path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>destFolder<span class="token punctuation">,</span><span class="token string">'src'</span><span class="token punctuation">,</span><span class="token string">'index.'</span><span class="token operator">+</span> opts<span class="token punctuation">.</span>appname <span class="token operator">+</span> <span class="token string">'.html'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>renderOpts
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token function">install</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 负责依赖模板的安装</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>options<span class="token punctuation">.</span>current<span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token comment">// 如果当前目录不是根目录 要先进入根目录</span>
            process<span class="token punctuation">.</span><span class="token function">chdir</span><span class="token punctuation">(</span>Path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span><span class="token function">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token keyword">this</span><span class="token punctuation">.</span>options<span class="token punctuation">.</span>appname<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>pkg <span class="token operator">&amp;&amp;</span> _<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>pkg<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>pkg<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">npmInstall</span><span class="token punctuation">(</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>pkg<span class="token punctuation">,</span><span class="token punctuation">{</span>
                    <span class="token string">'save-dev'</span><span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
                    <span class="token string">'skipMessage'</span><span class="token punctuation">:</span> <span class="token boolean">true</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

</code></pre></div><ol><li>收集用户配置。</li></ol> <p>在index.js的promptiong()方法里写，用户提示和收集配置信息。将配置信息放到renderOption变量里。将用户项目的第三方依赖模块放到pkg变量里。</p> <ol start="2"><li><p>转化动态内容</p> <ul><li>将ejs源文件中内容依据renderOption 转化为静态内容</li> <li>转化后的ejs文件复制到项目目录并且修改后缀名
ejs文件编写示例</li></ul> <div class="language-js extra-class"><pre class="language-js"><code>    boi<span class="token punctuation">.</span><span class="token function">spec</span><span class="token punctuation">(</span><span class="token string">'style'</span><span class="token punctuation">,</span><span class="token punctuation">{</span>
        <span class="token comment">// 后缀类型</span>
        ext<span class="token punctuation">:</span> <span class="token string">'&lt;%= styleSyntax %&gt;'</span><span class="token punctuation">,</span>
        <span class="token comment">// style文件夹相对于basic.source的目录</span>
        source<span class="token punctuation">:</span> <span class="token string">'style'</span><span class="token punctuation">,</span>
        <span class="token comment">// style 的输出目录相对于basic.output</span>
        output<span class="token punctuation">:</span> <span class="token string">'style'</span><span class="token punctuation">,</span>
        <span class="token comment">// 是否启用hash指纹</span>
        useHash<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        autoprefix<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        <span class="token comment">// 是否启用CSS Sprites自动生成功能</span>
        <span class="token operator">&lt;</span><span class="token operator">%</span> <span class="token keyword">if</span><span class="token punctuation">(</span>enableSprites<span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token operator">%</span><span class="token operator">&gt;</span>
            sprites<span class="token punctuation">:</span> <span class="token punctuation">{</span>
                <span class="token comment">// 散列图片目录</span>
                source<span class="token punctuation">:</span> <span class="token string">'icons'</span><span class="token punctuation">,</span>
                <span class="token comment">// 是否根据子目录分别编译输出</span>
                split<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
                <span class="token comment">// 是否识别retina命名标识</span>
                retina<span class="token punctuation">:</span> <span class="token boolean">true</span>
                postcssSpritesOpts<span class="token punctuation">:</span> <span class="token keyword">null</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token operator">&lt;</span><span class="token operator">%</span> <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span><span class="token operator">%</span><span class="token operator">&gt;</span>
            sprites<span class="token punctuation">:</span>fasle
        <span class="token operator">&lt;</span><span class="token operator">%</span> <span class="token punctuation">}</span><span class="token operator">%</span><span class="token operator">&gt;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div></li> <li><p>自动安装依赖模板
在install()函数里面编写安装依赖的代码，注意一定要确定用户所创建的项目根目录是否为当前面目录，如果是新目录，需要首先进入目标目录再执行安装</p></li></ol> <blockquote><p>集成到工程化体系中</p></blockquote> <p>目的： 1 统一工具栈  ，2 自动安装</p> <ol><li><p>集成到工程中使用的是 yeoman-environment这个模块，集成后我们使用命令 boi new &lt; appname &gt; --template &lt; templateName &gt; 来创建新项目</p></li> <li><p>集成实现</p> <p>使用commander.js 实现命令行的交互封装</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> Cli  <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'commander'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 脚手架</span>
Cli<span class="token punctuation">.</span><span class="token function">command</span><span class="token punctuation">(</span><span class="token string">'new [dir]'</span><span class="token punctuation">)</span>
 <span class="token punctuation">.</span><span class="token function">description</span><span class="token punctuation">(</span><span class="token string">'generate a new project'</span><span class="token punctuation">)</span>
 <span class="token punctuation">.</span><span class="token function">usage</span><span class="token punctuation">(</span><span class="token string">'[dir] [options]'</span><span class="token punctuation">)</span>
 <span class="token punctuation">.</span><span class="token function">option</span><span class="token punctuation">(</span><span class="token string">'-t, --template [template]'</span><span class="token punctuation">,</span> <span class="token string">'specify template of new app'</span><span class="token punctuation">)</span>
 <span class="token punctuation">.</span><span class="token function">action</span><span class="token punctuation">(</span><span class="token punctuation">(</span>dir<span class="token punctuation">,</span> options<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
     <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./features/generator.js'</span><span class="token punctuation">)</span><span class="token punctuation">(</span>dir<span class="token punctuation">,</span> options<span class="token punctuation">.</span>template<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'--help'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
     <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">'\n\n  Examples:\n'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">'    $ boi new'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">'    $ boi new page'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">'    $ boi new app -p demo'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">'    $ boi new app -p demo -t webapp\n'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>commander.js命令执行以后将参数传递给 features/generator中。此模块实现具体的yeoman继承和执行工作。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> Shell    <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'shelljs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> Yeoman   <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'yeoman-environment'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> _        <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'lodash'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> Path     <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> YeomanRuntime <span class="token operator">=</span> Yeoman<span class="token punctuation">.</span><span class="token function">createEnv</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token punctuation">(</span>dirname<span class="token punctuation">,</span> template<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> appname <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> inCurrentDir <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token comment">// 不指定TemplateName使用默认的boiapp模板</span>
    <span class="token keyword">const</span> TemplateName <span class="token operator">=</span> template <span class="token operator">&amp;&amp;</span> template<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token regex">/\:/</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">||</span> <span class="token string">'boiapp'</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> GenerateTemplate <span class="token operator">=</span> <span class="token template-string"><span class="token string">`generator-</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>TemplateName<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> AppCommand <span class="token operator">=</span> template <span class="token operator">||</span> TemplateName<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>dirname <span class="token operator">||</span> dirname <span class="token operator">===</span> <span class="token string">'.'</span> <span class="token operator">||</span> dirname <span class="token operator">===</span> <span class="token string">'./'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 如果不指定appname则取值当前目录名称</span>
        appname <span class="token operator">=</span> _<span class="token punctuation">.</span><span class="token function">last</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span><span class="token function">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token regex">/\//</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        inCurrentDir <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token comment">// 如果指定appname则创建子目录</span>
        appname <span class="token operator">=</span> dirname<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token comment">// to compate nvm system</span>
<span class="token comment">// 执行npm 命令</span>
Shell<span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span><span class="token string">'npm root -g'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token keyword">async</span><span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 是否异步</span>
    silent<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token comment">// 不输出信息到console</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>code<span class="token punctuation">,</span> stdout<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// global template path</span>
    <span class="token keyword">const</span> TemplatePath <span class="token operator">=</span> Path<span class="token punctuation">.</span>posix<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>_<span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span>stdout<span class="token punctuation">)</span><span class="token punctuation">,</span> GenerateTemplate<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> TemplateRealPath <span class="token operator">=</span> require<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>TemplatePath<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//判断模板是否安装了 如果安装则正常往下进行如果没有安装则抛出异常</span>
        YeomanRuntime<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span>TemplateRealPath<span class="token punctuation">,</span> AppCommand<span class="token punctuation">)</span><span class="token punctuation">;</span>
        inCurrentDir <span class="token operator">?</span> YeomanRuntime<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>AppCommand<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>appname<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> -c`</span></span><span class="token punctuation">)</span> <span class="token punctuation">:</span> YeomanRuntime<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>AppCommand<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>appname<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        Shell<span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`npm install -g </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>GenerateTemplate<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">,</span><span class="token punctuation">{</span>
            <span class="token keyword">async</span><span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 是否异步</span>
            silent<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token comment">// 不输出信息到console</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">(</span>code<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>code <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token comment">// 如果失败则结束进程</span>
                 process<span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            YeomanRuntime<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span>require<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>TemplatePath<span class="token punctuation">)</span><span class="token punctuation">,</span> AppCommand<span class="token punctuation">)</span><span class="token punctuation">;</span>
            inCurrentDir <span class="token operator">?</span> YeomanRuntime<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>AppCommand<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>appname<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> -c`</span></span><span class="token punctuation">)</span> <span class="token punctuation">:</span> YeomanRuntime<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>AppCommand<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>appname<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="_6-总结"><a href="#_6-总结" aria-hidden="true" class="header-anchor">#</a> 6.总结</h2> <p>以上代码都是实力代码，并不能直接运行，知识说明一种集成的形式，真正实现yeoman脚手架可以去查看yeoman或者使用完成的boi项目进行调试。</p></li></ol></div> <div class="page-edit"><!----> <!----></div> <!----> </div> <!----></div></div>
    <script src="/fengyestudybase/assets/js/app.0a47e211.js" defer></script><script src="/fengyestudybase/assets/js/36.c29f2ab2.js" defer></script>
  </body>
</html>
